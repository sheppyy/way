# 1. 虚拟环境 virtualenv

## 1.1 安装

```
pip intall virtualenv
```



## 1.2 创建虚拟环境

```
virtualenv 虚拟环境名称
virtualenv 虚拟环境名称 --python=python3.7
virtualenv 虚拟环境名称 --python='D:\ProgramData\Anaconda3\python.exe'
```



## 1.3 激活、退出虚拟环境

```
激活：
	D:\Work\Python\Envs\evnnane\Scripts\activate
退出：
	D:\Work\Python\Envs\evnnane\Scripts\deactivate
```



## 1.4 环境依赖

```
1. 导出环境依赖到文件
	pip freeze > requirements.txt
2. 安装环境依赖
	pip install -f requirements.txt
```





# 2. 搭建项目

## 2.1 使用pycharm创建项目



# 3. 本地配置 local_settings.py

```
原理：就是使用本地配置覆盖settings.py
本地配置的作用：
	1. 本地配置信息
	2. 给不同的运行环境提供配置
```

## 3.1 创建本地配置文件

- 在和settings.py同级目录下创建即可



## 3.2 在settings.py导入本地配置

```
try:
    from .local_settings import *
except ImportError:
    pass
```

## 3.3 在本地配置中写内容

```
LANGUAGE_CODE = 'zh-hans'
....
SMS = 666
```



注意：

	1. 若要在本地配置文件添加新的东西，也需要在settings.py里面创建，并赋一个初始值；
 	2. 

# 4. 在码云托管代码

代码托管：码云、github、gitlab



一、创建远程仓库

```
1. 登录码云：https://gitee.com/
2. 新建仓库
3. 输入仓库名称、仓库介绍
4. 公开
5. 创建
```

二、将本地仓库代码推到远程仓库

```
前提：
	git config --global user.name "你的码云昵称"
	git config --global user.email "你的码云邮箱"

1. 创建.gitignore文件，告诉git要忽略的文件，即不推送的文件。
.gitignore的内容：
    # pycharm
    .idea/
    .DS_Store

    __pycache__/
    *.py[cod]
    *$py.class

    # Django stuff:
    local_settings.py
    *.sqlite3
    media/

    # database migrations
    */migrations/*.py
    !*/migrations/__init__.py

2. 在项目根目录初始化git
	git inti

3. 将本地文件添加到待提交仓库
	git add .

4. 提交到本地仓库
	git commit -m 'firt commit'

5. 本地仓库提交到远程仓库
    1. 建立关联关系，取别名
    git remote add origin https://gitee.com/passingyourvegetablefield/test01.git
    2. 推送
    git push -u origin master
```

三、拉取代码

```
git clone https://gitee.com/passingyourvegetablefield/test01.git
```



# 5. 使用腾讯短信服务发短信

## 5.1 使用短信的地方

1. 注册
2. 登录
3. 验证

## 5.2 注册腾讯短信服务



## 5.3 安装短信SDK&发送短信

前提：信息都审核通过了。



1. 安装SDK

```
pip install qcloudsms_py
```

2. 基于SDK发送短信

```

```



## 5.4 





# 6. Redis操作

## 6.1 安装和操作

https://pythonav.com/wiki/detail/10/82/



## 6.2 操作Redis库 

1. **安装库**

```
1. pip isntall redis
2. pip install django-redis
```

2. **连接方式**

   - **直接连接**

   ```
   import redis
   conn = redis.Redis(host='10.211.55.28', port=6379, password='foobared', encoding='utf-8')
   conn.set('110', 9999, ex=10)
   value = conn.get('15131255089')
   print(value)
   ```

   - **连接池**

   ```
   import redis
   pool = redis.ConnectionPool(host='10.211.55.28', port=6379, password='foobared', encoding='utf-8', max_connections=1000)
   conn = redis.Redis(connection_pool=pool)
   conn.set('name', "value", ex=10)
   value = conn.get('name')
   print(value)
   ```

   - **使用django连接redis**

   ```
   import redis
   from django.shortcuts import HttpResponse
   POOL = redis.ConnectionPool(host='10.211.55.28', port=6379, password='foobared', encoding='utf-8', max_connections=1000)
   def index(request):
       conn = redis.Redis(connection_pool=POOL)
       conn.set('name', "value", ex=10)
       value = conn.get('name')
       print(value)
       return HttpResponse("ok")
   ```

   - **在django中推荐的方式**

   ```
   1.在django项目的settings.py中添加相关配置
   
       # 上面是django项目settings中的其他配置....
       CACHES = {
           "default": {
               "BACKEND": "django_redis.cache.RedisCache",
               "LOCATION": "redis://10.211.55.28:6379",
               "OPTIONS": {
                   "CLIENT_CLASS": "django_redis.client.DefaultClient",
                   "CONNECTION_POOL_KWARGS": {
                       "max_connections": 1000,
                       "encoding": 'utf-8'
                   },
                   "PASSWORD": "foobared"
               }
           }
       }
       
   2. 在django的视图中操作redis
   
       from django.shortcuts import HttpResponse
       from django_redis import get_redis_connection
       
       def index(request):
           conn = get_redis_connection("default")
           conn.set('nickname', "value", ex=10)
           value = conn.get('nickname')
           print(value)
           return HttpResponse("OK")
   ```

   









# 7. 使用python生成图片并在图片说明写文字：图片验证码

## 7.1 安装库

```
pip install pillow
```

https://www.cnblogs.com/wupeiqi/articles/5812291.html







# 8.django离线脚本

```
离线脚本：即在非项目运行时，执行的程序
脚本：一个或多个py文件
```

1. 要想在django执行离线脚本，实现相应的功能，需要先加载django的环境





# 9.数据表

### 9.1 价格策略

| id   | 分类 | 标题     | 价格/年 | 项目个数 | 成员数/项目 | 项目空间/G | 单个文件 | 创建时间 |      |
| ---- | ---- | -------- | ------- | -------- | ----------- | ---------- | -------- | -------- | ---- |
| 1    | 免费 | 个人免费 | 0       | 5        | 5           | 10         | 2M       |          |      |
| 2    | 收费 | VIP      | 199     | 20       | 100         | 50         | 500M     |          |      |
| 3    | 收费 | SVIP     | 299     | 50       | 200         | 100        | G1       |          |      |
| 4    | 其他 |          |         |          |             |            |          |          |      |

当新用户注册，则给免费额度



### 9.2 用户

| id   | 姓名 | 手机   | 密码   |
| ---- | ---- | ------ | ------ |
| 1    | ydc1 | 110*** | 112121 |
| 2    | ydc2 | 120*** | 16552  |

### 9.3 交易

| id   | 状态   | 用户 | 价格 | 实际付款 | 开始时间 | 结束时间 | 数量/年 |      |      |
| ---- | ------ | ---- | ---- | -------- | -------- | -------- | ------- | ---- | ---- |
| 1    | 已支付 | 1    | 1    | 0        | 2020-8-1 | null     | 0       |      |      |
| 2    | 已支付 | 2    | 1    | 0        | 2020-8-1 | null     | 0       |      |      |
| 3    | 已支付 | 3    | 1    | 0        | 2020-8-1 | null     | 0       |      |      |
| 4    | 已支付 | 2    | 2    | 199      | 2020-8-1 | 2021-8-1 | 1       |      |      |
| 5    | 已支付 | 3    | 3    | 299*1    | 2020-8-1 | 2022-8-1 | 2       |      |      |
|      |        |      |      |          |          |          |         |      |      |





### 9.4 创建存储

基于腾讯对象存储COS存储数据（文件）



### 9.5 用户创建的项目

| ID   | 项目名称 | 描述 | 背景颜色 | 星标  | 参与人数 | 创建者 | 已用空间 |
| ---- | -------- | ---- | -------- | ----- | -------- | ------ | -------- |
| 1    | ERP      |      | pink     | true  | 5        | 3      | 5M       |
| 2    | CRM      |      | blue     | false | 5        | 3      | 1G       |
| 3    | OA       |      | black    | false | 5        | 3      | 2G       |



## 9.6 项目参与者



| ID   | 项目 | 用户 | 星标  | 邀请者 |      |      |      |      |      |
| ---- | ---- | ---- | ----- | ------ | ---- | ---- | ---- | ---- | ---- |
| 1    | 1    | 1    | true  | 3      |      |      |      |      |      |
| 2    | 1    | 2    | true  | 3      |      |      |      |      |      |
| 3    | 2    | 1    | false | 3      |      |      |      |      |      |









。。。。



# 10 项目

## 10.1 项目展示

1. 获取两份数据

- 获取创建的项目数据
- 
- 
- 获取参与的项目数据



2. 筛选出星标的项目



**即三分数据：星标，创建，参与**





## 10.2 星标项目



### 1 星标

```
创建：Project.star = True
参与：Participant.star = True
```



### 2 取消星标

```
创建：Project.star = False
参与：Participant.star = False
```





# 11 项目管理



## 11.1 路由规划



```
/manage/project_id/dashboard
/manage/project_id/issues
/manage/project_id/statistics
/manage/project_id/file
/manage/project_id/wiki
/manage/project_id/setting
```



```
include():
	1. 传递include(('web.urls', 'web'), namespace='web'))
	2. 传递include(([url1, url2, url3, ...], None), None)
```





## 11.2 进入项目

```
- 进入项目
- 展示菜单
```

要求：顺序必须是进入项目后再显示菜单。



判断是否进入了项目：

- 判断url的组成
- 判断项目是否为本人的项目



**注意：**

​		

```
1. django找模板的顺序：是先找根目录下的templates,再根据注册app的顺序，找对应app里面的templates
2. django在的数据模型的字段，在MoDelForm内可以覆盖修改，在页面显示会改变
3. 验证码不需要长期保存，使用redis数据库保存，并设置失效时间
4. 各个app都应该在内部创建templates文件夹，并在templates文件夹里面创建与app同名的文件夹存放本app的所有模板；公共模板则放在根目录下的templates文件夹。
5. django中的模板继承语句必须在第一行，{% extends 'layout/basic.html' %}
6. 可以使用构造函数将外部对象传递到类内部使用。
7. django中的session有效期为两周

```



# 12 wiki



## 12.1 表结构设计



| id   | 标题 | 内容  | 项目ID | 父ID |
| ---- | ---- | ----- | ------ | ---- |
| 1    | mark | ydc   | 1      | null |
| 2    | jack | maker | 1      | 1    |
| 3    | rose | yang  | 2      | 1    |







## 12.2 快速开发

页面

添加

预览

编辑/修改/删除

目录展示



## 12.3 应用markdown组件

- 富文本编辑器，ckeditor
- markdown编辑器，mdeditor

- 添加和编辑的页面，textarea输入框，改成Markdown编辑器

```
1. 应用css
2. 应用js


说明：
	editor.md地址：
	1. https://pandao.github.io/editor.md/examples/index.html
	2. https://github.com/pandao/editor.md
	3. 
	
	使用editor取代textarea
```

### 12 .3.1 真页面应用markdown编辑器的步骤：

1. 引入css和js

```html
<link rel="stylesheet" href="{% static 'plugin/editor.md/css/editormd.min.css' %}">
<script src="{% static 'plugin/editor.md/editormd.min.js' %}"></script>
```

2. 定义载体，即textarea标签

```html
<div id="editor">
	<input type='textarea'>
</div>
```

3. 初始化Markdown

```js
$(function () {
    initCatalog();
    // 初始化editor.md
    initEditorMd();
});
// 初始化editor.md
    function initEditorMd() {
        editormd('editor', {
            placeholder: '请输入内容',
            height: 500,
            path: '{% static "plugin/editor.md/lib/" %}',  // 指定依赖文件地址
    })
}
```

### 12.3.2 在页面预览markdown格式的内容

1. 引入css和js

```
<link rel="stylesheet" href="{% static 'plugin/editor.md/css/editormd.preview.min.css' %}">

<script src="{% static 'plugin/editor.md/editormd.min.js' %}"></script>
<script src="{% static 'plugin/editor.md/lib/marked.min.js' %}"></script>
<script src="{% static 'plugin/editor.md/lib/prettify.min.js' %}"></script>
<script src="{% static 'plugin/editor.md/lib/raphael.min.js' %}"></script>
<script src="{% static 'plugin/editor.md/lib/underscore.min.js' %}"></script>
<script src="{% static 'plugin/editor.md/lib/sequence-diagram.min.js' %}"></script>
<script src="{% static 'plugin/editor.md/lib/flowchart.min.js' %}"></script>
<script src="{% static 'plugin/editor.md/lib/jquery.flowchart.min.js' %}"></script>
```

2. 定义textarea标签

```
<div id="previewMarkdown">
	<textarea>{{ wiki_obj.content }}</textarea>
</div>
```

3. 初始化markdown对象

```js
$(function () {
    initCatalog();
    // 初始化 预览的Markdown
    initPreviewMd();
});

function initPreviewMd(){
    editormd.markdownToHTML('previewMarkdown', {
        htmlDecode: 'style,script,iframe',  // 过滤掉的东西，将以普通文本的形式展示
    })
}
```



### 12.3.3 markdown本地上传图片









## 12.4 腾讯COS上传

对象存储Python SDK：https://cloud.tencent.com/document/product/436/12269



### 12.4.1 开通腾讯cos



官网:https://cloud.tencent.com/



1. 登录腾讯云
2. 找到对象存储
3. 立即使用
4. 创建桶存储（即文件夹或区域、块的意思）



### 12.4.2 配置环境

Python 对象存储SDK：https://cloud.tencent.com/document/product/436/12269



1. 安装SDK

```
pip install -U cos-python-sdk-v5
```

2. 初始化

```python
# -*- coding=utf-8
# appid 已在配置中移除,请在参数 Bucket 中带上 appid。Bucket 由 BucketName-APPID 组成
# 1. 设置用户配置, 包括 secretId，secretKey 以及 Region
from qcloud_cos import CosConfig
from qcloud_cos import CosS3Client
import sys

secret_id = 'COS_SECRETID'      # 替换为用户的 secretId
secret_key = 'COS_SECRETKEY'      # 替换为用户的 secretKey
# 	https://ydc-1302759476.cos.ap-nanjing.myqcloud.com/test.jpg 
region = 'ap-nanjing'     # 替换为用户的 Region
token = None                # 使用临时密钥需要传入 Token，默认为空，可不填
scheme = 'https'            # 指定使用 http/https 协议来访问 COS，默认为 https，可不填
config = CosConfig(Region=region, SecretId=secret_id, SecretKey=secret_key, Token=token, Scheme=scheme)
# 2. 获取客户端对象
client = CosS3Client(config)
# 参照下文的描述。或者参照 Demo 程序，详见 https://github.com/tencentyun/cos-python-sdk-v5/blob/master/qcloud_cos/demo.py
```

3. 创建桶

```python
# 创建存储桶
response = client.create_bucket(
    Bucket='bucket'
)
```

4. 上传文件

```python
#### 高级上传接口（推荐）
# 根据文件大小自动选择简单上传或分块上传，分块上传具备断点续传功能。
response = client.upload_file(
    Bucket='bucket',  # 桶的名称
    LocalFilePath='local.txt',  # 本地要上传的文件路径
    Key='picture.jpg',  # 上传后的文件名
    PartSize=1,  # 分成多少部分上传
    MAXThread=10,  # 最大线程数
    EnableMD5=False  # 是否支持md5
)
print(response['ETag'])
```



**秘钥在秘钥管理那里找到**



文件上传示例

```python
from qcloud_cos import CosConfig
from qcloud_cos import CosS3Client

secret_id = ''  # 替换为用户的 secretId
secret_key = ''  # 替换为用户的 secretKey
region = 'ap-nanjing'  # 替换为用户的 Region

config = CosConfig(Region=region, SecretId=secret_id, SecretKey=secret_key)

client = CosS3Client(config)

response = client.upload_file(
    Bucket='Bucket',  # 桶的名称
    LocalFilePath='index-1.png',  # 本地要上传的文件路径
    Key='cow.jpg',
)

print(response['ETag'])
```





















