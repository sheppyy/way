





# 1 å…¥é—¨



## 1.1 å®‰è£…Django

```
pip install django

è¯´æ˜ï¼š
	1. å¦‚æœä¸æŒ‡å®šç‰ˆæœ¬ï¼Œåˆ™å®‰è£…æœ€æ–°çš„LTSç‰ˆæœ¬
	2. è¿˜æ˜¯æŒ‡å®šä¸€ä¸‹å¥½ï¼Œpip install django==2.2
	3.
```



## 1.2 Djangoé¡¹ç›®



### 1.2.1 å‚åŠ ä¸€ä¸ªDjangoé¡¹ç›®



åœ¨æ§åˆ¶å°æ‰§è¡Œ

```
django-admin startproject mysite

è¯´æ˜ï¼š
	1. mysiteæ˜¯é¡¹ç›®å
	2. æ‰§è¡Œå‘½ä»¤åï¼Œä¼šåˆ›å»ºä¸€ä¸ªè·Ÿé¡¹ç›®ç›¸åŒåå­—çš„æ–‡ä»¶å¤¹ä½œä¸ºå®¹å™¨ï¼Œç„¶åæŠŠé¡¹ç›®æ”¾åœ¨é‡Œé¢
	3. å¦‚æœä¸æƒ³å‚åŠ æ–‡ä»¶å¤¹å®¹å™¨ï¼Œå¯ä»¥è‡ªå·±åˆ›å»ºï¼Œ
		django-admin startproject ak .
		å³åœ¨å½“å‰ç›®å½•åˆ›å»ºDjangoé¡¹ç›®
```



### 1.2.2 Djangoé¡¹ç›®çš„ç›®å½•ç»“æ„



```
mysqite              # ç›®å½•å®¹å™¨ï¼Œè·ŸDjangoæ²¡å•¥å…³ç³»ï¼Œå¯ä»¥è‡ªå·±å–å
	mysite           # Djangoé¡¹ç›®çš„åç§°ï¼Œæ˜¯ä¸€ä¸ªPythonåŒ…
		__init__.py  # ç©ºæ–‡ä»¶ï¼Œæ ‡è¯†è¯¥æ–‡ä»¶å¤¹æ˜¯ä¸€ä¸ªåŒ…
		settings.py  # é¡¹ç›®çš„é…ç½®æ–‡ä»¶
		urls.py      # é¡¹ç›®çš„urlè¯´æ˜æ–‡ä»¶ï¼Œé¡¹ç›®çš„urlå…¥å£æ–‡ä»¶
		wsgi.py      # å…¼å®¹WSGIçš„WebæœåŠ¡å™¨çš„å…¥å£ç‚¹ï¼Œç”¨äºä¼ºæœé¡¹ç›®ã€‚
	manage.py        # é¡¹ç›®å¯åŠ¨è„šæœ¬ï¼Œé¡¹ç›®çš„æ“ä½œåŸºæœ¬éƒ½åŸºäºè¿™ç©æ„å„¿
```



### 1.2.3 Djangoé¡¹ç›®çš„é…ç½®æ–‡ä»¶



Djangoé¡¹ç›®çš„é…ç½®æ–‡ä»¶éƒ½ä¼šæ”¾åœ¨ settings.pyæ–‡ä»¶ä¸‹ã€‚

å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æŠŠé…ç½®æ–‡ä»¶åˆ†å¼€æ”¾ï¼Œç„¶ååœ¨ settings.pyçš„æœ€åè¿›è¡Œimportã€‚



- TIME_ZONE

æ—¶åŒºé…ç½®ï¼Œä¸€èˆ¬éƒ½å…ˆè®¾ç½®æˆè‡ªå·±çš„æ—¶åŒº

```
TIME_ZONE = 'Asia/Shanghai'
```



- INSTALLED_APPS

æ˜¯åº”è¯¥åˆ—è¡¨ï¼Œé‡Œé¢éƒ½æ”¾ç€Djangoä¸­çš„appï¼ˆåº”ç”¨ï¼‰ã€‚

åœ¨Djangoä¸­ï¼Œåº”ç”¨çš„è®¾è®¡æ˜¯è¿™æ ·çš„ï¼š

```
ä¸€ä¸ªåº”ç”¨å¯ä»¥åœ¨å¤šä¸ªé¡¹ç›®ä¸­ä½¿ç”¨ï¼Œè€Œä¸”åº”ç”¨å¯ä»¥æ‰“åŒ…ï¼Œä¾›å…¶ä»–é¡¹ç›®ä½¿ç”¨ã€‚
```

```python
INSTALLED_APPS = [
    'django.contrib.admin',  # å†…ç½®çš„ç®¡ç†åå°
    'django.contrib.auth',  # èº«ä»½éªŒè¯ç³»ç»Ÿ æƒé™ç³»ç»Ÿ
    'django.contrib.contenttypes',  # å†…å®¹ç±»å‹æ¡†æ¶
    'django.contrib.sessions',  # ä¼šè¯æ¡†æ¶  ç¼“å­˜ä¹‹ç±»çš„
    'django.contrib.messages',  # æ¶ˆæ¯æ¡†æ¶
    'django.contrib.staticfiles',  # ç®¡ç†é™æ€æ–‡ä»¶çš„æ¡†æ¶
]

è¯´æ˜ï¼š
	1. è¿™äº›åº”ç”¨æ˜¯é»˜è®¤åŒ…å«çš„
    2. è‡ªå·±å‚åŠ çš„åº”ç”¨ç›´æ¥æ·»åŠ åé¢å³å¯
    3. æŸäº›åº”ç”¨æ˜¯ç”¨åˆ°æ•°æ®åº“çš„ï¼Œæ‰€ä»¥éœ€è¦å…ˆè¿ç§»ä¸€ä¸‹æ•°æ®åº“ï¼ˆDjangoé»˜è®¤å¸¦åˆ—ä»¥sqlit.dbï¼‰:
    	python manage.py migtate
```



### 1.2.4 å¯åŠ¨é¡¹ç›®



æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°±æˆäº†ã€‚ğŸ˜„

```
python manage.py runserver
```

çœŸåœ°å€æ è¾“å…¥ï¼šhttp://127.0.0.1:8000/



## 1.3 æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆMVCï¼‰è®¾è®¡æ¨¡å¼



MVCæ˜¯ä¸€ä¸ªè®¾è®¡ç†å¿µï¼Œå‡ ä¹æ‰€æœ‰çš„Webæ¡†æ¶éƒ½å›´ç»•å®ƒå»è®¾è®¡å®ç°ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“ï¼ŒçŒœçš„:dog:ï¼‰ã€‚

- æ¨¡å‹ï¼ˆMï¼‰
  - æ˜¯æ•°æ®çš„è¡¨è¿°ã€‚
  - å®ƒä¸æ˜¯çœŸæ­£çš„æ•°æ®ï¼Œè€Œæ˜¯æ•°æ®çš„æ¥å£ã€‚
  - ä½¿ç”¨æ¨¡å‹ä»æ•°æ®åº“ä¸­è·å–æ•°æ®æ—¶ï¼Œæ— éœ€çŸ¥é“åº•å±‚æ•°æ®åº“é”™ç»¼å¤æ‚çš„çŸ¥è¯†ã€‚
  - æ¨¡å‹é€šå¸¸è¿˜ä¼šä¸ºæ•°æ®åº“æä¾›ä¸€å±‚æŠ½è±¡ï¼Œè¿™æ ·åŒä¸€ä¸ªæ¨¡å‹å°±èƒ½ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“ã€‚



- è§†å›¾ï¼ˆVï¼‰
  - æ˜¯ä½ çœ‹åˆ°çš„ç•Œé¢ã€‚
  - å®ƒæ˜¯æ¨¡å‹çš„è¡¨ç°å±‚ã€‚
  - åœ¨ç”µè„‘ä¸­ï¼Œè§†å›¾æ˜¯ä½ åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°çš„ Web åº”ç”¨çš„é¡µé¢ï¼Œæˆ–è€…æ˜¯æ¡Œé¢åº”ç”¨çš„ UIã€‚
  - è§†å›¾è¿˜æä¾›äº†æ”¶é›†ç”¨æˆ·è¾“å…¥çš„æ¥å£ã€‚



- æ§åˆ¶å™¨ï¼ˆCï¼‰
  - æ§åˆ¶æ¨¡å‹å’Œè§†å›¾ä¹‹é—´çš„ä¿¡æ¯æµåŠ¨ã€‚
  - å®ƒé€šè¿‡ç¨‹åºé€»è¾‘åˆ¤æ–­é€šè¿‡æ¨¡å‹ä»æ•°æ®åº“ä¸­è·å–ä»€ä¹ˆä¿¡æ¯ï¼Œä»¥åŠæŠŠä»€ä¹ˆä¿¡æ¯ä¼ ç»™è§†å›¾ã€‚
  - å®ƒè¿˜é€šè¿‡è§†å›¾ä»ç”¨æˆ·é‚£é‡Œæ”¶é›†ä¿¡æ¯ï¼Œå¹¶ä¸”å®ç°ä¸šåŠ¡é€»è¾‘ï¼šå˜æ›´è§†å›¾ï¼Œæˆ–è€…é€šè¿‡æ¨¡å‹ä¿®æ”¹æ•°æ®ï¼Œæˆ–è€…äºŒè€…å…¼å…·ã€‚



ç»“æ„å¦‚å›¾ï¼ˆç™¾åº¦çš„ğŸ˜„ï¼‰ï¼š

![6 MVC](D:\Me\Way\Django2\imags\6 MVC.jpg)



è®¾è®¡ç†å¿µæ˜¯æ­»çš„ï¼Œæ¡†æ¶å½¢å¼ä¹Ÿé‚£æ ·äº†ï¼ŒçœŸæ­£éš¾çš„æ˜¯å¦‚ä½•ç†è§£å„å±‚çš„ä½œç”¨ï¼Œä¸åŒçš„æ¡†æ¶å¾€å¾€ä¼šä½¿ç”¨ä¸åŒçš„æ–¹å¼å®ç°åŒæ ·çš„åŠŸèƒ½ã€‚



## 1.4 MTV



Django ä¸¥æ ¼éµå®ˆ MVC æ¨¡å¼ï¼Œä½†æ˜¯æœ‰è‡ªå·±çš„å®ç°é€»è¾‘ã€‚

â€œCâ€éƒ¨åˆ†ç”±æ¡†æ¶å¤„ç†ï¼Œå¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬çš„å·¥ä½œåœ¨æ¨¡å‹ã€æ¨¡æ¿å’Œè§†å›¾ä¸­ï¼Œå› æ­¤ Django ç»å¸¸è¢«ç§°ä¸º MTV æ¡†æ¶ã€‚



åœ¨ MTV å¼€å‘æ¨¡å¼ä¸­:

- M è¡¨ç¤ºâ€œæ¨¡å‹â€
  - å³æ•°æ®è®¿é—®å±‚ã€‚
  - è¿™ä¸€å±‚åŒ…å«æ‰€æœ‰ä¸æ•°æ®ç›¸å…³çš„åŠŸèƒ½ï¼šè®¿é—®æ•°æ®çš„æ–¹å¼ã€éªŒè¯æ•°æ®çš„æ–¹å¼ã€æ•°æ®çš„è¡Œä¸ºã€æ•°æ®ä¹‹é—´çš„å…³ç³»ã€‚
- T è¡¨ç¤ºâ€œæ¨¡æ¿â€
  - å³è¡¨ç°å±‚ã€‚
  - è¿™ä¸€å±‚åŒ…å«è¡¨ç°ç›¸å…³çš„å†³ç­–ï¼šåœ¨ç½‘é¡µæˆ–å…¶ä»–æ–‡æ¡£ç±»å‹ä¸­å¦‚ä½•æ˜¾ç¤ºæŸä¸ªä¸œè¥¿ã€‚
- V è¡¨ç¤ºâ€œè§†å›¾â€
  - å³ä¸šåŠ¡é€»è¾‘å±‚ã€‚
  - è¿™ä¸€å±‚åŒ…å«è®¿é—®æ¨¡å‹å’Œé€‰æ‹©åˆé€‚æ¨¡æ¿çš„é€»è¾‘ã€‚
  - å¯ä»¥æŠŠè§†å›¾çœ‹åšæ¨¡å‹å’Œæ¨¡æ¿ä¹‹é—´çš„æ¡¥æ¢ã€‚



Django çš„è§†å›¾æ›´åƒæ˜¯ MVC ä¸­çš„æ§åˆ¶å™¨ï¼Œè€Œ MVC ä¸­çš„è§†å›¾æ˜¯ Django ä¸­çš„æ¨¡æ¿ã€‚

åæ­£å¯¹ç€æ¥å°±è¡Œäº†

```
MVC
MTV
```





# 2 è§†å›¾å’ŒURLé…ç½®



## 2.1 ç¬¬ä¸€ä¸ªè§†å›¾ï¼šé™æ€å†…å®¹



è§†å›¾å‡½æ•°å†™åœ¨ views.pyä¸­ï¼ˆå½“ç„¶ï¼Œåé¢æ˜¯å¯ä»¥æ‹†åˆ†çš„ï¼‰ã€‚

urlé…ç½®å†™åœ¨ urls.pyä¸­ï¼Œå¦‚æœæœ‰åˆ›å»ºåº”ç”¨ï¼Œåˆ™æŠŠåº”ç”¨çš„ urls.pyåŒ…å«åˆ°é¡¹ç›®çš„ urls.py



è§†å›¾view.py

```python
from django.http import HttpResponse

def hello(request):
	return HttpResponse("Hello world")
```



url.py

```python
from django.conf.urls import include, url
from django.contrib import admin
from mysite.views import hello

urlpatterns = [
    url(r'^admin/', include(admin.site.urls)),
    url(r'^hello/$', hello),  # urlå’Œè§†å›¾å‡½æ•°ç»‘å®šåœ¨ä¸€èµ·ï¼Œä»¥å¯¹è±¡çš„å½¢å¼ä¼ å…¥helloè§†å›¾å‡½æ•°ï¼Œè€Œæ²¡æœ‰è°ƒç”¨å‡½æ•°ï¼ˆå³æ²¡æœ‰æ‹¬å·ï¼‰ã€‚
]
```

å¯åŠ¨é¡¹ç›®åï¼ŒæœåŠ¡/hello/åœ°å€å°±å¯ä»¥çœ‹åˆ°Hello worldã€‚



### 2.1.1 æ­£åˆ™è¡¨è¾¾å¼



æ­£åˆ™è¡¨è¾¾å¼ï¼ˆregular expressionï¼Œç®€ç§° regexesï¼‰æ˜¯æŒ‡å®šæ–‡æœ¬æ¨¡å¼çš„ç®€æ´æ–¹å¼ã€‚

Django çš„ URL é…ç½®å…è®¸ä½¿ç”¨ä»»ä½•æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å¤æ‚çš„ URLï¼Œä½†æ˜¯å®é™…ä¸Šåªä¼šä½¿ç”¨éƒ¨åˆ†ç¬¦å·ã€‚



å¸¸ç”¨ç¬¦å·

| ç¬¦å·       | åŒ¹é…å†…å®¹                                                     |      |
| ---------- | ------------------------------------------------------------ | ---- |
| . ï¼ˆç‚¹å·ï¼‰ | å•ä¸ªå­—ç¬¦                                                     |      |
| \d         | å•ä¸ªæ•°å­—                                                     |      |
| [A-Z]      | A-Zï¼ˆå¤§å†™ï¼‰ä¹‹é—´çš„å•ä¸ªå­—æ¯                                    |      |
| [a-z]      | a-zï¼ˆå°å†™ï¼‰ä¹‹é—´çš„å•ä¸ªå­—æ¯                                    |      |
| [A-Za-z]   | a-zï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ä¹‹é—´çš„å•ä¸ªå­—æ¯                            |      |
| +          | ä¸€ä¸ªæˆ–å¤šä¸ªå‰è¿°è¡¨è¾¾å¼ï¼ˆä¾‹å¦‚ï¼Œ \d+ åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—ï¼‰        |      |
| [Ë†/]+      | ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ï¼Œç›´åˆ°é‡åˆ°æ–œçº¿ï¼ˆä¸å«ï¼‰                         |      |
| ï¼Ÿ         | é›¶ä¸ªæˆ–ä¸€ä¸ªå‰è¿°è¡¨è¾¾å¼ï¼ˆä¾‹å¦‚ï¼Œ \d? åŒ¹é…é›¶ä¸ªæˆ–ä¸€ä¸ªæ•°å­—ï¼‰        |      |
| *          | é›¶ä¸ªæˆ–å¤šä¸ªå‰è¿°è¡¨è¾¾å¼ï¼ˆä¾‹å¦‚ï¼Œ \d* åŒ¹é…é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—ï¼‰  |      |
| {1,3}      | ä»‹äºä¸€ä¸ªåˆ°ä¸‰ä¸ªä¹‹é—´ï¼ˆå«ï¼‰çš„å‰è¿°è¡¨è¾¾å¼ï¼ˆä¾‹å¦‚ï¼Œ \d{1,3} åŒ¹é…ä¸€ä¸ªã€ä¸¤ä¸ªæˆ–ä¸‰ä¸ªæ•°å­—ï¼‰ |      |



### 2.1.2 å…³äº 404 é”™è¯¯



åœ¨è°ƒè¯•æ¨¡å¼ä¸‹ï¼Œå½“è®¿é—®ä¸å­˜åœ¨çš„urlæ—¶ï¼Œå°†ä¼šè¿”å›404é”™è¯¯å“åº”ç ï¼Œå¹¶è¿”å›ä¸€ä¸‹è°ƒè¯•ä¿¡æ¯ã€‚

åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ï¼Œè®¿é—®ä¸å­˜åœ¨çš„urlä»…è¿”å›404é”™è¯¯ä¿¡æ¯ã€‚



### 2.1.3 å…³äºç½‘ç«™æ ¹åœ°å€



è®¿é—®http://127.0.0.1:8000/ æ—¶ï¼Œä¼š404ï¼Œå› ä¸ºæ²¡æœ‰æ²¡æœ‰é…ç½®æ ¹åœ°å€ã€‚



ä¸ºç½‘ç«™æ ¹åœ°å€å®ç°è§†å›¾æ—¶ï¼Œä½¿ç”¨çš„ URL æ¨¡å¼æ˜¯ Ë†$ ï¼Œå³åŒ¹é…ç©ºå­—ç¬¦ä¸²ã€‚

```python
url(r'^$', home)
```

å°½é‡ä¸è¦è¿™æ ·

```python
url(r'^/$', home)
```





### 2.1.4 Django å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹



ç”¨æˆ·è®¿é—®/hello/åœ°å€ï¼Œæµè§ˆå™¨å‘DjangoæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼›

Djangoä»settings.pyæ–‡ä»¶æ‰¾åˆ°ROOT_URLCONFé…ç½®ï¼Œæ‰¾åˆ°æ ¹URLé…ç½®ï¼›

åœ¨æ ¹URLé…ç½®ä¸­æŒ‰é¡ºåºæ¯”è¾ƒæ‰€æœ‰çš„URLæ¨¡å¼ï¼Œæ‰¾åˆ°å’Œ/hello/åŒ¹é…çš„é‚£ä¸ªï¼›

è°ƒç”¨å¯¹åº”çš„è§†å›¾å‡½æ•°ï¼›è§†å›¾å‡½æ•°å¤„ç†å®Œåï¼Œå¿…é¡»è¿”å›ä¸€ä¸ªHttpResponseæˆ–BaseHttpResponseå¯¹è±¡ï¼›

DjangoæŠŠè§†å›¾å‡½æ•°å“åº”çš„å¯¹è±¡è§£ææˆHTTPå“åº”ï¼Œå¾—åˆ°ç½‘é¡µï¼›



ç®€å•çš„æµç¨‹å°±æ˜¯ï¼š

1. è¯·æ±‚ /hello/ ã€‚

2. Django æŸ¥çœ‹ ROOT_URLCONF è®¾ç½®ï¼Œæ‰¾åˆ°æ ¹ URL é…ç½®ã€‚
3. Django æ¯”è¾ƒ URL é…ç½®ä¸­çš„å„ä¸ª URL æ¨¡å¼ï¼Œæ‰¾åˆ°ä¸ /hello/ åŒ¹é…çš„é‚£ä¸ªã€‚
4. å¦‚æœæ‰¾åˆ°åŒ¹é…çš„æ¨¡å¼ï¼Œè°ƒç”¨å¯¹åº”çš„è§†å›¾å‡½æ•°ã€‚
5. è§†å›¾å‡½æ•°è¿”å›ä¸€ä¸ª HttpResponse å¯¹è±¡ã€‚
6. Django æŠŠ HttpResponse å¯¹è±¡è½¬æ¢æˆæ­£ç¡®çš„ HTTP å“åº”ï¼Œå¾—åˆ°ç½‘é¡µã€‚

```
è¯´æ˜ï¼š
	1. æ‰¾ä¸åˆ°URLæ¨¡å¼å°±æŠ¥é”™
	2. 
```





## 2.2 ç¬¬äºŒä¸ªè§†å›¾:åŠ¨æ€å†…å®¹



æ˜¾ç¤ºåŠ¨æ€çš„å†…å®¹ã€‚

views.py

```python
from django.shortcuts import HttpResponse
import datetime


def hello(request):

	return HttpResponse('Hello World')

def current_datetime(request):
	now = datetime.datetime.now()
	html = 'It is now %s.' % now
    
	return HttpResponse(html)
```

urls.py

```python
from django.contrib import admin
from django.urls import path
from django.conf.urls import url
from mysite.views import hello
from mysite.views import current_datetime


urlpatterns = [
    url(r'admin/', admin.site.urls),
    url(r'hello/', hello),
    url(r'time/', current_datetime),
]
```





## 2.3 URL é…ç½®å’Œæ¾è€¦åˆ



æ¾è€¦åˆæ˜¯ä¸€ç§è½¯ä»¶å¼€å‘æ–¹å¼ï¼Œå…¶ä»·å€¼åœ¨äºè®©ç»„ä»¶å¯ä»¥äº’æ¢ã€‚

å¦‚æœä¸¤éƒ¨åˆ†ä»£ç ä¹‹é—´æ˜¯æ¾è€¦åˆçš„ï¼Œé‚£ä¹ˆæ”¹åŠ¨å…¶ä¸­ä¸€éƒ¨åˆ†å¯¹å¦ä¸€éƒ¨åˆ†çš„å½±å“å¾ˆå°ï¼Œç”šè‡³æ²¡æœ‰å½±å“ã€‚

Django çš„ URL é…ç½®å°±å¾ˆå¥½åœ°è¿ç”¨äº†è¿™ä¸ªåŸåˆ™ã€‚åœ¨ Django Web åº”ç”¨ä¸­ï¼ŒURL å®šä¹‰ä¸æ‰€è°ƒç”¨çš„è§†å›¾å‡½æ•°ä¹‹é—´æ˜¯æ¾è€¦åˆçš„ï¼Œå³æŸä¸ªåŠŸèƒ½ä½¿ç”¨å“ªä¸ª URL ä¸è§†å›¾å‡½æ•°çš„å®ç°æœ¬èº«æ”¾åœ¨ä¸¤ä¸ªåœ°æ–¹ã€‚



## 2.4 ç¬¬ä¸‰ä¸ªè§†å›¾ï¼šåŠ¨æ€url



æœ‰äº›urlæ˜¯åŠ¨æ€ç»„æˆçš„ï¼Œæ¯”å¦‚ /articles/1/ï¼Œåˆ™å¯ä»¥è¯´æ˜¯æ­£åˆ™åŠ¨æ€åŒ¹é…urlã€‚

```python
url(r'^articles/\d+/$', detail)

è¯´æ˜ï¼š
	1. \d+è¡¨ç¤ºåŒ¹é…æ•°å­—ï¼Œ5ï¼Œ200ï¼Œ100000
```

å¯ä»¥æŒ‡å®šæ•°å­—çš„ä½æ•°

```python
url(r'^articles/\d{1, 2}/$', detail)

è¯´æ˜ï¼š
	1. \d{1, 2}è¡¨ç¤ºä¸€ä½æˆ–ä¸¤ä½æ•°å­—
	1. è¿™æ ·ä»…ä»…æ˜¯urlä¸­çš„åŒ¹é…è€Œå·²ï¼Œè§†å›¾å‡½æ•°æ— æ³•è·å–åˆ°é‚£ä¸ªæ•°å­—
```

```python
url(r'^articles/(\d{1, 2})/$', detail)

è¯´æ˜ï¼š
	1. åŠ ä¸Š(),å°±å¯ä»¥æŠŠè¿™å‚æ•°ä¼ é€’åˆ°è§†å›¾å‡½æ•°ä½¿ç”¨äº†
    2. ()å°±æ˜¯æŠ½å–æ•°æ®ç”¨çš„
```



å°†urlä¸Šçš„å˜é‡ä¼ é€’åˆ°è§†å›¾å‡½æ•°ä½¿ç”¨

views.py

```python
from django.shortcuts import HttpResponse


def url_num(request, num):

	html = 'your number is %s' % num

	return HttpResponse(html)
```

urls.py

```python
from django.conf.urls import url
from mysite.views import url_num

urlpatterns = [
    url(r'^num/(\d{1,2})/', url_num),
]
```

æµè§ˆå™¨è¾“å…¥ï¼šhttp://127.0.0.1:8080/num/99/







## 2.5 å…³äºDjango url



1. Python ä¸­çš„åæ–œçº¿ä¸æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„åæ–œçº¿æœ‰å†²çªï¼Œå› æ­¤åœ¨ Django ä¸­å®šä¹‰æ­£åˆ™è¡¨è¾¾å¼æ—¶æœ€å¥½ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²ã€‚

```python
# åœ¨urlå‰é¢åŠ  'r' å­—ç¬¦ï¼Œå°†å­—ç¬¦ä¸²å˜æˆåŸå§‹å­—ç¬¦ä¸²ï¼Œå³è®©é‚£äº›æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦å˜æˆæ™®é€šå­—ç¬¦
url(r'^admin/', include(admin.site.urls))
```

2.  urlæ¨¡å¼çš„ä¸€ä¸‹ä¸åŒ



**url: http://127.0.0.1:8000/hello/** 



- å³æƒ³åŒ¹é…çš„æ˜¯/hello/ï¼Œä½†urlå†™çš„å´æ˜¯url(r'^hello/$', hello)

  åŸå› ï¼šDjango åœ¨æ£€æŸ¥ URL æ¨¡å¼æ—¶ä¼šæŠŠå…¥ç«™ URL å‰é¢çš„æ–œçº¿å»æ‰ã€‚

  æ‰€ä»¥ï¼ŒURL æ¨¡å¼ä¸­æ²¡æœ‰å‰å¯¼æ–œçº¿ã€‚

  

- è„±å­—ç¬¦å·ï¼ˆ^ï¼‰å’Œä¸€ä¸ªç¾å…ƒç¬¦å·ï¼ˆ$ï¼‰

  å³æ­£åˆ™è¡¨è¾¾å¼çš„å«ä¹‰ï¼Œ^ï¼šä»¥...å¼€å¤´ï¼Œ$ï¼šä»¥...ç»“å°¾

  åŸåˆ™ï¼š

  â€‹	ï¼ˆ1ï¼‰ä¸€èˆ¬éƒ½åœ¨å‰é¢^

  â€‹	ï¼ˆ2ï¼‰å¦‚æœç¡®å®šæœ¬urlæ˜¯æœ€åä¸€çº§äº†ï¼Œå°±åŠ $ï¼Œè·Ÿé¡¹ç›®çš„urls.pyé‚£é‡Œçš„urlæœ€åéƒ½ä¸åŠ ï¼Œä¸ç„¶åŒ¹é…ä¸åˆ°å­è·¯ç”±ã€‚



- /hello

  å¦‚æœè¯·æ±‚çš„urlæ˜¯/helloï¼Œå³æ²¡æœ‰åé¢çš„é‚£ä¸ªæ–œçº¿ã€‚

  Djangoä¼šè¿™ä¹ˆåšï¼š

  ```
  é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœè¯·æ±‚çš„ URL ä¸åŒ¹é…ä»»ä½• URL æ¨¡å¼ï¼Œè€Œä¸”æœ«å°¾æ²¡æœ‰æ–œçº¿ï¼Œé‚£ä¹ˆ Django ä¼šæŠŠå®ƒé‡å®šå‘åˆ°æœ«å°¾å¸¦æ–œçº¿çš„ URLã€‚
  ```

  

# 3 Djangoæ¨¡æ¿





## 3.1 æ¨¡æ¿ç®€è¿°



Django æ¨¡æ¿æ˜¯ä¸€äº›æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œä½œç”¨æ˜¯æŠŠæ–‡æ¡£çš„è¡¨ç°ä¸æ•°æ®åŒºåˆ†å¼€ã€‚

æ¨¡æ¿å®šä¹‰ä¸€äº›å ä½ç¬¦å’ŒåŸºæœ¬çš„é€»è¾‘ï¼ˆæ¨¡æ¿æ ‡ç­¾ï¼‰ï¼Œè§„å®šå¦‚ä½•æ˜¾ç¤ºæ–‡æ¡£ã€‚é€šå¸¸ï¼Œæ¨¡æ¿ç”¨äºç”Ÿæˆ HTMLï¼Œä¸è¿‡ Django æ¨¡æ¿å¯ä»¥ç”Ÿæˆä»»ä½•åŸºäºæ–‡æœ¬çš„æ ¼å¼ã€‚



```html
<html>
    <head>
        <title>Ordering notice</title>
    </head>
    <body>
        <h1>Ordering notice</h1>
        <p>Dear {{ person_name }},</p>
        <p>Thanks for placing an order from {{ company }}. It's scheduled to ship on {{
            ship_date|date:"F j, Y" }}.</p>
        <p>Here are the items you've ordered:</p>
        <ul>
            {% for item in item_list %}
            <li>{{ item }}</li>{% endfor %}
        </ul>
        {% if ordered_warranty %}
        <p>Your warranty information will be included in the packaging.</p>
        {% else %}
        <p>
            You didn't order a warranty, so you're on your own when
            the products inevitably stop working.
        </p>
        {% endif %}
        <p>Sincerely,<br />{{ company }}</p>
    </body>
</html>
```

- {{ arg }}ï¼šåŒèŠ±æ‹¬å·åŒ…å›´çš„æ˜¯å˜é‡ï¼Œå³ä¸å˜é‡çš„å€¼æ’å…¥åˆ°htmlé¡µé¢
- {% if %}ï¼šèŠ±æ‹¬å·å’Œç™¾åˆ†å·åŒ…å›´çš„æ–‡æœ¬æ˜¯æ¨¡æ¿æ ‡ç­¾ï¼Œç”¨äºç©ºä¸­æ¨¡æ¿åšäº‹æƒ…ã€‚
-  {{ ship_date|date:"F j, Y" }}ï¼šæ¶¨è¿™æ ·çš„æ˜¯è¿‡æ»¤å™¨ï¼Œè¿‡æ»¤å™¨ä½¿ç”¨ç®¡é“ç¬¦å·ï¼ˆ | ï¼‰ä¼ å€¼
- 



## 3.2 æ¨¡æ¿ç³»ç»Ÿ



Djangoé»˜è®¤ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“æ˜¯DTLï¼Œå³ Django Template Languageï¼Œè¿˜æœ‰ä¸€ä¸ªæµè¡Œçš„æ¨¡æ¿å¼•æ“æ˜¯Jinja2ã€‚



DTLçš„åŸºæœ¬å·¥ä½œæµç¨‹æ˜¯ï¼š

- ä»¥å­—ç¬¦ä¸²å½¢å¼æä¾›åŸå§‹çš„æ¨¡æ¿ä»£ç ï¼Œåˆ›å»º Template å¯¹è±¡ã€‚
- åœ¨ Template å¯¹è±¡ä¸Šè°ƒç”¨ render() æ–¹æ³•ï¼Œä¼ å…¥ä¸€ç³»åˆ—å˜é‡ï¼ˆä¸Šä¸‹æ–‡ï¼‰ã€‚
- è¿”å›çš„æ˜¯å®Œå…¨æ¸²æŸ“æ¨¡æ¿åå¾—åˆ°çš„å­—ç¬¦ä¸²ï¼Œæ¨¡æ¿ä¸­çš„å˜é‡å’Œæ¨¡æ¿æ ‡ç­¾å·²ç»æ ¹æ®ä¸Šä¸‹æ–‡æ±‚å‡ºå€¼äº†ã€‚

ä»£ç æµç¨‹ï¼š

```python
from django import template

# åˆ›å»ºæ¨¡æ¿
t = template.Template('My name is {{ name }}.')
# åˆ›å»ºä¸Šä¸‹æ–‡å¯¹è±¡
c = template.Context({'name': 'Nige'})
# æ¸²æŸ“
print (t.render(c))
# è¾“å‡ºï¼šMy name is Nige.
```



### 3.2.1 åˆ›å»ºTemplateå¯¹è±¡



åˆ›å»º Template å¯¹è±¡æœ€ç®€å•çš„æ–¹å¼æ˜¯ç›´æ¥å®ä¾‹åŒ–ã€‚ 

Template ç±»åœ¨ django.template æ¨¡å—ä¸­ï¼Œæ„é€ æ–¹æ³•æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³åŸå§‹çš„æ¨¡æ¿ä»£ç ã€‚

åˆ›å»º Template å¯¹è±¡æ—¶ï¼Œæ¨¡æ¿ç³»ç»Ÿä¼šæŠŠåŸå§‹çš„æ¨¡æ¿ä»£ç ç¼–è¯‘æˆå†…éƒ¨ä½¿ç”¨çš„ä¼˜åŒ–å½¢å¼ï¼Œä¸ºæ¸²æŸ“åšå¥½å‡†å¤‡ã€‚



â€œå—çº§æ ‡ç­¾â€å’Œâ€œæ¨¡æ¿æ ‡ç­¾â€æ˜¯åŒä¸€ä¸ªäº‹ç‰©ã€‚

é‡åˆ°ä¸‹è¿°å„ç§æƒ…å†µæ—¶ï¼Œæ¨¡æ¿ç³»ç»Ÿéƒ½ä¼šæŠ›å‡º TemplateSyntaxError ï¼š

```html
æ— æ•ˆæ ‡ç­¾
æœ‰æ•ˆæ ‡ç­¾çš„æ— æ•ˆå‚æ•°
æ— æ•ˆè¿‡æ»¤å™¨
æœ‰æ•ˆè¿‡æ»¤å™¨çš„æ— æ•ˆå‚æ•°
æ— æ•ˆæ¨¡æ¿å¥æ³•
æœªå…³é—­çš„æ ‡ç­¾ï¼ˆå¯¹éœ€è¦ç»“æŸæ ‡ç­¾çš„æ¨¡æ¿æ ‡ç­¾è€Œè¨€ï¼‰
```



### 3.2.2  æ¸²æŸ“æ¨¡æ¿



æœ‰äº† Template å¯¹è±¡ä¹‹åï¼Œå¯ä»¥ä¸ºå…¶æä¾›ä¸Šä¸‹æ–‡ï¼ŒæŠŠæ•°æ®ä¼ ç»™å®ƒã€‚

ä¸Šä¸‹æ–‡å°±æ˜¯ä¸€ç³»åˆ—æ¨¡æ¿å˜é‡å’Œç›¸åº”çš„å€¼ã€‚æ¨¡æ¿ä½¿ç”¨ä¸Šä¸‹æ–‡å¡«å……å˜é‡ï¼Œæ±‚å€¼æ ‡ç­¾ã€‚

åœ¨ Django ä¸­ï¼Œä¸Šä¸‹æ–‡ä½¿ç”¨ django.template æ¨¡å—ä¸­çš„ Context ç±»è¡¨ç¤ºã€‚

å®ƒçš„æ„é€ æ–¹æ³•æ¥å—ä¸€ä¸ªå¯é€‰å‚æ•°ï¼šä¸€ä¸ªå­—å…¸ï¼ŒæŠŠå˜é‡åæ˜ å°„åˆ°å€¼ä¸Šã€‚





## 3.3 å­—å…¸å’Œä¸Šä¸‹æ–‡



Python å­—å…¸æ˜¯é”®å’Œå€¼çš„æ˜ å°„ã€‚ Context å¯¹è±¡ç±»ä¼¼äºå­—å…¸ï¼Œä½†æ˜¯å®ƒæœ‰é¢å¤–çš„åŠŸèƒ½ã€‚

å˜é‡åå¿…é¡»ä»¥å­—æ¯å¼€å¤´ï¼ˆA-Z æˆ– a-zï¼‰ï¼Œéšåå¯ä»¥è·Ÿç€ä»»æ„å¤šä¸ªå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œç‚¹å·ã€‚





### 3.3.1 ä¸Šä¸‹æ–‡çš„æŸ¥æ‰¾



**ç‚¹å·**å¯ä»¥è®¿é—®å±æ€§ã€å­—å…¸çš„é”®ã€æ–¹æ³•æˆ–å¯¹è±¡çš„ç´¢å¼•ã€‚

- å­—å…¸çš„è®¿é—®

```
user = {'name': 'ydc'}

åœ¨æ¨¡æ¿ä¸­ï¼š
	user.name
```

- è®¿é—®å±æ€§

```
d = datetime.date(2020, 8, 20)

åœ¨æ¨¡æ¿ä¸­ï¼š
	d.year
	d.month
	d.day
```

- è®¿é—®å¯¹è±¡çš„å±æ€§

```python
class User(object):
	def __init__(self, name, age):
        self.name = name
        self.age = age

user = User('ydc', 25)
        
åœ¨æ¨¡æ¿ä¸­ï¼š
	user.name
    user.age
```

- å¼•ç”¨å¯¹è±¡çš„æ–¹æ³•

```
string = 'ydc'

åœ¨æ¨¡æ¿ä¸­ï¼š
	sting.upper
	string.isdigit

è¯´æ˜ï¼š
	1. æ–¹æ³•è°ƒç”¨ä¸­æ²¡æœ‰æ‹¬å·ï¼Œä¸èƒ½ç»™æ–¹æ³•ä¼ é€’å˜é‡ï¼Œåªèƒ½è°ƒç”¨æ— éœ€å‚æ•°çš„æ–¹æ³•ã€‚
	2. åœ¨Pythonä¸­åˆ™æ˜¯ï¼šsting.upper()
```

- è®¿é—®åˆ—è¡¨ç´¢å¼•

```
lst = [1, 2, 3, 4, 5]

åœ¨æ¨¡æ¿ä¸­ï¼š
	lst.0
	lst.1
	lst.2

è¯´æ˜ï¼š
	1. ä¸å…è®¸ä½¿ç”¨è´Ÿæ•°ç´¢å¼•ã€‚lst.-1 ä¼šç‚¸ï¼ŒæŠ¥TemplateSyntaxErroré”™ã€‚
	2. 
```



æ³¨æ„ï¼š

	1. ç‚¹å·æŸ¥æ‰¾å¯ä»¥åµŒå¥—å¤šå±‚ã€‚ {{ person.name.upper }}ï¼Œç›¸å½“äºä¸€ä¸ªå­—å…¸æŸ¥æ‰¾ï¼ˆ person['name'] ï¼‰åŠ ä¸Šä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼ˆ upper() ï¼‰
 	2. æ¨¡æ¿ç³»ç»Ÿå°†ä½¿ç”¨ç¬¬ä¸€ä¸ªå¯ç”¨çš„ç±»å‹ï¼Œè¿™æ˜¯ä¸€ç§çŸ­è·¯é€»è¾‘ã€‚



### 3.3.2 æ¨¡æ¿ä¸­æ–¹æ³•è°ƒç”¨çš„è¡Œä¸º



æ¨¡æ¿ä¸­çš„æ–¹æ³•è°ƒç”¨è¦å¤æ‚ï¼Œä¸”éœ€è¦æ³¨æ„ï¼š

- åœ¨æ–¹æ³•æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œå¼‚å¸¸ä¼šå‘ä¸Šå†’æ³¡ï¼Œé™¤éå¼‚å¸¸æœ‰ silent_variable_failure å±æ€§ï¼Œè€Œä¸”å€¼ä¸º True ã€‚å¦‚æœå¼‚å¸¸ç¡®å®æœ‰ silent_variable_failure å±æ€§ï¼Œä½¿ç”¨å¼•æ“çš„ string_if_invalidé…ç½®é€‰é¡¹ï¼ˆé»˜è®¤ä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼‰æ¸²æŸ“å˜é‡ã€‚

- æ–¹æ³•ä¸èƒ½æœ‰å¿…é¡»çš„å‚æ•°ã€‚å¦åˆ™ï¼Œæ¨¡æ¿ç³»ç»Ÿå‘åç§»åŠ¨åˆ°ä¸‹ä¸€ç§æŸ¥è¯¢ç±»å‹ï¼ˆåˆ—è¡¨ç´¢å¼•æŸ¥è¯¢ï¼‰ã€‚
- Django é™åˆ¶äº†åœ¨æ¨¡æ¿ä¸­å¯ä»¥å¤„ç†çš„é€»è¾‘é‡ï¼Œå› æ­¤åœ¨æ¨¡æ¿ä¸­ä¸èƒ½ç»™æ–¹æ³•ä¼ é€’å‚æ•°ã€‚æ•°æ®åº”è¯¥åœ¨è§†å›¾ä¸­è®¡ç®—ä¹‹åå†ä¼ ç»™æ¨¡æ¿æ˜¾ç¤ºã€‚
- å‡å¦‚æœ‰ä¸ª BankAccount å¯¹è±¡

```
å®ƒæœ‰ä¸ª delete() æ–¹æ³•ã€‚å¦‚æœæ¨¡æ¿ä¸­æœ‰ {{ account.delete }} è¿™æ ·çš„å†…å®¹ï¼Œå…¶ä¸­ account æ˜¯ BankAccount å¯¹è±¡ï¼Œé‚£ä¹ˆæ¸²æŸ“æ¨¡æ¿æ—¶ä¼šæŠŠ account åˆ é™¤ã€‚ä¸ºäº†é¿å…è¿™ç§è¡Œä¸ºï¼Œåœ¨æ–¹æ³•ä¸Šè®¾å®šå‡½æ•°å±æ€§ alters_data ï¼š
	def delete(self):
        # åˆ é™¤è´¦æˆ·
        delete.alters_data = True

è¿™æ ·æ ‡è®°ä¹‹åï¼Œæ¨¡æ¿ç³»ç»Ÿä¸ä¼šæ‰§è¡Œæ–¹æ³•ã€‚ç»§ç»­ä½¿ç”¨å‰é¢çš„ä¾‹å­ã€‚å¦‚æœæ¨¡æ¿ä¸­æœ‰ {{ account.delete }} ï¼Œè€Œ delete() æ–¹æ³•è®¾å®šäº† alters_data=True ï¼Œé‚£ä¹ˆæ¸²æŸ“æ¨¡æ¿æ—¶ä¸ä¼šæ‰§è¡Œ delete() æ–¹æ³•ï¼Œå¼•æ“ä¼šä½¿ç”¨string_if_invalid çš„å€¼æ›¿æ¢é‚£ä¸ªå˜é‡ã€‚

ä¸º Django æ¨¡å‹å¯¹è±¡åŠ¨æ€ç”Ÿæˆçš„ delete() å’Œ save() æ–¹æ³•è‡ªåŠ¨è®¾å®šäº† alters_data = True ã€‚
```



### 3.3.3  å¦‚ä½•å¤„ç†æ— æ•ˆå˜é‡



å¦‚æœå˜é‡ä¸å­˜åœ¨ï¼Œæ¨¡æ¿ç³»ç»Ÿåœ¨å˜é‡å¤„æ’å…¥å¼•æ“çš„ string_if_invalid é…ç½®é€‰é¡¹ã€‚

è¿™ä¸ªé€‰é¡¹çš„é»˜è®¤å€¼ä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚

è¿™ä¸€è¡Œä¸ºæ¯”æŠ›å‡ºå¼‚å¸¸å¥½ï¼Œå› ä¸ºé‡åˆ°äººä¸ºé”™è¯¯æ—¶èƒ½è¿…é€Ÿæ¢å¤ã€‚





## 3.4 åŸºæœ¬çš„æ¨¡æ¿æ ‡ç­¾å’Œè¿‡æ»¤å™¨



Django çš„æ¨¡æ¿ç³»ç»Ÿè‡ªå¸¦äº†ä¸€äº›å†…ç½®çš„æ ‡ç­¾å’Œè¿‡æ»¤å™¨ã€‚

è¿‡æ»¤å™¨è·ŸPythoné‡Œé¢çš„å†…ç½®çš„å‡½æ•°åŠŸèƒ½å‡ ä¹ä¸€æ ·ï¼Œå°±å†™æ³•ä¸ä¸€æ ·ã€‚



### 3.4.1 æ ‡ç­¾



#### **if/else**



{% if  %} è®¡ç®—å˜é‡çš„å€¼ï¼Œå¦‚æœä¸ºçœŸï¼ˆå³å­˜åœ¨ã€ä¸ä¸ºç©ºï¼Œä¸æ˜¯å‡å€¼ï¼‰ï¼Œæ¨¡æ¿ç³»ç»Ÿæ˜¾ç¤º {% if %} å’Œ {% endif %}ä¹‹é—´çš„å†…å®¹ã€‚

{% if %} æ”¯æŒä½¿ç”¨ and ã€ or æˆ– not æµ‹è¯•å¤šä¸ªå˜é‡ï¼Œæˆ–è€…å–åæŒ‡å®šçš„å˜é‡ã€‚

```python
{% if athlete_list and not coach_list %}
	<p>There are some athletes and absolutely no coaches. </p>
{% endif %}
```



#### **for**



{% for %} æ ‡ç­¾ç”¨äºè¿­ä»£åºåˆ—ä¸­çš„å„ä¸ªå…ƒç´ ã€‚

æ¯æ¬¡è¿­ä»£æ—¶ï¼Œæ¨¡æ¿ç³»ç»Ÿä¼šæ¸²æŸ“ {% for %} å’Œ {% endfor %} ä¹‹é—´çš„å†…å®¹ã€‚



```python
<ul>
    {% for athlete in athlete_list %}
    	<li>{{ athlete.name }}</li>
    {% endfor %}
</ul>
```



åœ¨æ ‡ç­¾ä¸­æ·»åŠ  reversed ï¼Œåå‘è¿­ä»£åˆ—è¡¨ï¼š

```
{% for athlete in athlete_list reversed %}
	{{ athlete }}
{% endfor %}
```



{% for %} æ ‡ç­¾å¯ä»¥åµŒå¥—:

```python
{% for athlete in athlete_list %}
    <h1>{{ athlete.name }}</h1>
    <ul>
        {% for sport in athlete.sports_played %}
        	<li>{{ sport }}</li>
        {% endfor %}
    </ul>
{% endfor %}
```



å¦‚æœéœ€è¦è¿­ä»£ç”±åˆ—è¡¨æ„æˆçš„åˆ—è¡¨ï¼Œå¯ä»¥æŠŠæ¯ä¸ªå­åˆ—è¡¨ä¸­çš„å€¼æ‹†åŒ…åˆ°ç‹¬ç«‹çš„å˜é‡ä¸­ã€‚
æ¯”å¦‚è¯´ä¸Šä¸‹æ–‡ä¸­æœ‰ä¸€ä¸ªåŒ…å« (x,y) åæ ‡ç‚¹çš„åˆ—è¡¨ï¼Œåä¸º points ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹è¿°æ¨¡æ¿è¾“å‡ºè¿™äº›åæ ‡ç‚¹ï¼š

```python
{% for x, y in points %}
	<p>There is a point at {{ x }},{{ y }}</p>
{% endfor %}
```



å¦‚æœéœ€è¦è®¿é—®å­—å…¸ä¸­çš„å…ƒç´ ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ ‡ç­¾ã€‚

å¦‚æœä¸Šä¸‹æ–‡ä¸­åŒ…å«ä¸€ä¸ªå­—å…¸ data ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹è¿°æ¨¡æ¿æ˜¾ç¤ºå­—å…¸çš„é”®å’Œå€¼ï¼š

```python
{% for key, value in data.items %}
	{{ key }}: {{ value }}
{% endfor %}
```



 for æ ‡ç­¾æ”¯æŒä¸€ä¸ªå¯é€‰çš„ {% empty %} å­å¥ï¼Œç”¨äºå®šä¹‰åˆ—è¡¨ä¸ºç©ºæ—¶æ˜¾ç¤ºçš„å†…å®¹ã€‚

```python
{% for athlete in athlete_list %}
    <p>{{ athlete.name }}</p>
{% empty %}
    <p>There are no athletes. Only computer programmers.</p>
{% endfor %}
```



åœ¨ {% for %} å¾ªç¯å†…éƒ¨ï¼Œå¯ä»¥è®¿é—®ä¸€ä¸ªåä¸º forloop çš„æ¨¡æ¿å˜é‡ã€‚

- forloop.counter çš„å€¼æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå¾ªç¯çš„æ¬¡æ•°ã€‚è¿™ä¸ªå±æ€§çš„å€¼ä» 1 å¼€å§‹ï¼Œå› æ­¤ç¬¬ä¸€æ¬¡å¾ªç¯æ—¶,forloop.counter ç­‰äº 1 ã€‚
- forloop.counter0 ä¸ forloop.counter ç±»ä¼¼ï¼Œä¸è¿‡æ˜¯ä»é›¶å¼€å§‹çš„ã€‚ç¬¬ä¸€æ¬¡å¾ªç¯æ—¶ï¼Œå…¶å€¼ä¸º 0 ã€‚
- forloop.revcounter çš„å€¼æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå¾ªç¯ä¸­å‰©ä½™çš„å…ƒç´ æ•°é‡ã€‚ç¬¬ä¸€æ¬¡å¾ªç¯æ—¶ï¼Œ for-loop.revcounter çš„å€¼æ˜¯åºåˆ—ä¸­è¦éå†çš„å…ƒç´ æ€»æ•°ã€‚æœ€åä¸€æ¬¡å¾ªç¯æ—¶ï¼Œ forloop.revcounter çš„å€¼ä¸º 1ã€‚
- forloop.revcounter0 ä¸ forloop.revcounter ç±»ä¼¼ï¼Œä¸è¿‡ç´¢å¼•æ˜¯åŸºäºé›¶çš„ã€‚ç¬¬ä¸€æ¬¡å¾ªç¯æ—¶ï¼Œ for-
  loop.revcounter0 çš„å€¼æ˜¯åºåˆ—ä¸­å…ƒç´ æ•°é‡å‡å»ä¸€ã€‚æœ€åä¸€æ¬¡å¾ªç¯æ—¶ï¼Œ forloop.revcounter0 çš„å€¼ä¸º 0ã€‚
- forloop.first æ˜¯ä¸ªå¸ƒå°”å€¼ï¼Œç¬¬ä¸€æ¬¡å¾ªç¯æ—¶ä¸º True ã€‚
- forloop.last æ˜¯ä¸ªå¸ƒå°”å€¼ï¼Œæœ€åä¸€æ¬¡å¾ªç¯æ—¶ä¸º True ã€‚
- åœ¨åµŒå¥—çš„å¾ªç¯ä¸­ï¼Œ forloop.parentloop å¼•ç”¨çˆ¶çº§å¾ªç¯çš„ forloop å¯¹è±¡ã€‚



#### **ifequal/ifnotequal**



Django æ¨¡æ¿ç³»ç»Ÿä¸æ˜¯åŠŸèƒ½å…¨é¢çš„ç¼–ç¨‹è¯­è¨€ï¼Œä¸å…è®¸æ‰§è¡Œä»»æ„çš„ Python è¯­å¥ã€‚

æ¨¡æ¿ç»å¸¸éœ€è¦æ¯”è¾ƒä¸¤ä¸ªå€¼ï¼Œåœ¨ç›¸ç­‰æ—¶æ˜¾ç¤ºä¸€äº›å†…å®¹ã€‚ä¸ºæ­¤ï¼ŒDjango æä¾›äº† {% ifequal %} æ ‡ç­¾ã€‚

{% ifequal %} æ ‡ç­¾æ¯”è¾ƒä¸¤ä¸ªå€¼ï¼Œå¦‚æœç›¸ç­‰ï¼Œæ˜¾ç¤º {% ifequal %} å’Œ {% endifequal %} ä¹‹é—´çš„å†…å®¹ã€‚

{% ifnotequal %} çš„ä½œç”¨ä¸ ifequal ç±»ä¼¼ï¼Œä¸è¿‡å®ƒæµ‹è¯•ä¸¤ä¸ªå‚æ•°æ˜¯å¦ä¸ç›¸ç­‰ã€‚

 ifnotequal æ ‡ç­¾å¯ä»¥æ›¿æ¢æˆ ifæ ‡ç­¾å’Œ != è¿ç®—ç¬¦ã€‚



### 3.4.2 è¿‡æ»¤å™¨



æ¨¡æ¿è¿‡æ»¤å™¨æ˜¯åœ¨æ˜¾ç¤ºå˜é‡ä¹‹å‰è°ƒæ•´å˜é‡å€¼çš„ç®€å•æ–¹å¼ã€‚è¿‡æ»¤å™¨ä½¿ç”¨ç®¡é“ç¬¦å·æŒ‡å®šï¼Œç®¡é“åé¢çš„ä¸ºç»™è¿‡æ»¤å™¨çš„ä¼ å‚ã€‚

è¿‡æ»¤å™¨å¯ä»¥ä¸²æ¥ï¼Œå³æŠŠä¸€ä¸ªè¿‡æ»¤å™¨çš„è¾“å‡ºä¼ ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚

```python
{{ my_list|first|upper }}
```



æœ‰äº›è¿‡æ»¤å™¨å¯ä»¥æ¥å—å‚æ•°ã€‚è¿‡æ»¤å™¨çš„å‚æ•°æ”¾åœ¨å†’å·ä¹‹åï¼Œå§‹ç»ˆæ”¾åœ¨åŒå¼•å·å†…ã€‚

```python
{{ bio|truncatewords:"30" }}
```



å‡ ä¸ªé‡è¦çš„è¿‡æ»¤å™¨

- addslashes ï¼šåœ¨åæ–œçº¿ã€å•å¼•å·å’ŒåŒå¼•å·å‰é¢æ·»åŠ ä¸€ä¸ªåæ–œçº¿ã€‚å¯ç”¨äºè½¬ä¹‰å­—ç¬¦ä¸²ã€‚
  - ä¾‹å¦‚ï¼š {{ val-ue|addslashes }} ã€‚
- date ï¼šæ ¹æ®å‚æ•°ä¸­çš„æ ¼å¼å­—ç¬¦ä¸²æ ¼å¼åŒ– date æˆ– datetime å¯¹è±¡ã€‚
  - ä¾‹å¦‚ï¼š {{ pub_date|date:"F j, Y"}} ã€‚
- length ï¼šè¿”å›å€¼çš„é•¿åº¦ã€‚å¯¹åˆ—è¡¨æ¥è¯´ï¼Œè¿”å›å…ƒç´ çš„æ•°é‡ã€‚å¯¹å­—ç¬¦ä¸²æ¥è¯´ï¼Œè¿”å›å­—ç¬¦çš„æ•°é‡ã€‚å¦‚æœå˜é‡
  æœªå®šä¹‰ï¼Œè¿”å› 0 ã€‚





## 3.5 ç†å¿µå’Œå±€é™



Django çš„æ ¸å¿ƒï¼š

1. è¡¨ç°ä¸é€»è¾‘åˆ†ç¦»
2. é¿å…é‡å¤
3. ä¸ HTML è§£è€¦
4. XML ä¸å¥½
5. ä¸è¦æ±‚å…·å¤‡è®¾è®¡èƒ½åŠ›
6. é€æ˜å¤„ç†ç©ºæ ¼
7. ä¸é‡é€ ä¸€é—¨ç¼–ç¨‹è¯­è¨€
8. ç¡®ä¿å®‰å…¨æœ‰ä¿éšœ
9. å¯æ‰©å±•



## 3.6 åœ¨è§†å›¾ä¸­ä½¿ç”¨æ¨¡æ¿







## 3.7 æ¨¡æ¿åŠ è½½æœºåˆ¶



é¦–å…ˆè¦å‘Šè¯‰æ¡†æ¶æ¨¡æ¿çš„å­˜å‚¨ä½ç½®ã€‚



```python
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
        	# ... ä¸€äº›é€‰é¡¹ ...
        },
    },
]
```

BACKEND çš„å€¼æ˜¯ä¸€ä¸ªç‚¹åˆ† Python è·¯å¾„ï¼ŒæŒ‡å‘å®ç° Django æ¨¡æ¿åç«¯ API çš„æ¨¡æ¿å¼•æ“ç±»ã€‚

å¤šæ•°å¼•æ“ä»æ–‡ä»¶ä¸­åŠ è½½æ¨¡æ¿ï¼Œæ‰€ä»¥å„ä¸ªå¼•æ“çš„é¡¶å±‚é…ç½®åŒ…å«ä¸‰ä¸ªé€šç”¨çš„è®¾ç½®ï¼š

- DIRS å®šä¹‰ä¸€ä¸ªç›®å½•åˆ—è¡¨ï¼Œæ¨¡æ¿å¼•æ“æŒ‰é¡ºåºåœ¨é‡Œé¢æŸ¥æ‰¾æ¨¡æ¿æºæ–‡ä»¶ã€‚
-  APP_DIRS è®¾å®šæ˜¯å¦åœ¨å®‰è£…çš„åº”ç”¨ä¸­æŸ¥æ‰¾æ¨¡æ¿ã€‚æŒ‰çº¦å®šï¼Œ APPS_DIRS è®¾ä¸º True æ—¶ï¼Œ DjangoTemplates ä¼šåœ¨INSTALLED_APPS ä¸­çš„å„ä¸ªåº”ç”¨é‡ŒæŸ¥æ‰¾åä¸ºâ€œtemplatesâ€çš„å­ç›®å½•ã€‚è¿™æ ·ï¼Œå³ä½¿ DIRS ä¸ºç©ºï¼Œæ¨¡æ¿å¼•æ“è¿˜èƒ½æŸ¥æ‰¾åº”ç”¨æ¨¡æ¿ã€‚
- OPTIONS æ˜¯ä¸€äº›é’ˆå¯¹åç«¯çš„è®¾ç½®ã€‚





### 3.7.1 æ¨¡æ¿ç›®å½•





DIRS çš„é»˜è®¤å€¼æ˜¯ä¸€ä¸ªç©ºåˆ—è¡¨ï¼ŒDjangoä¼šæ ¹æ®é‡Œé¢çš„å€¼å¯»æ‰¾æ¨¡æ¿ã€‚

```python
'DIRS': [
    '/home/html/example.com',
    '/home/html/default',
],
```



æ³¨æ„

 1. å¦‚æœæ²¡æœ‰åˆ›å»ºappï¼ŒDIRSæœ€å¥½ç•™ç©ºï¼›

 2. å¦‚æœçœŸæ ¹ç›®å½•æ”¾äº†å…¬å…±çš„æ¨¡æ¿ï¼Œåˆ™

    'DIRS': [os.path.join(BASE_DIR, 'templates')],

	3. æ¨¡æ¿ç›®å½•åç§°templatesä¸æ˜¯å¿…é¡»çš„

	4. æ³¨æ„ç³»ç»Ÿé—´çš„è·¯å¾„åˆ†éš”ç¬¦

    Windowsï¼š/

    Linuxï¼š\



Djangoé€‰æ‹©æ¨¡æ¿ï¼Œæ˜¯å…ˆä»æ ¹ç›®å½•å¼€å§‹æ‰¾èµ·ï¼Œæ ¹ç›®å½•æ‰¾ä¸åˆ°ï¼Œå†æŒ‰appæ³¨å†Œçš„é¡ºåºï¼Œåˆ°appä¸­æŸ¥æ‰¾ã€‚



## 3.8 render()



```python
from django.shortcuts import render
import datetime

def current_datetime(request):
    now = datetime.datetime.now()
    return render(request, 'current_datetime.html', {'current_date': now})
```

render() çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¯·æ±‚å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ¨¡æ¿åç§°ï¼Œç¬¬ä¸‰ä¸ªå•æ•°å¯é€‰ï¼Œæ˜¯ä¸€ä¸ªå­—æ®µï¼Œç”¨äºåˆ›å»ºç»™æ¨¡æ¿çš„ä¸Šä¸‹æ–‡ã€‚

å¦‚æœä¸æŒ‡å®šç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œ render() ä½¿ç”¨ä¸€ä¸ªç©ºå­—å…¸ã€‚



## 3.9 æ¨¡æ¿å­ç›®å½•



å¦‚æœæŠŠæ‰€æœ‰æ¨¡æ¿å­˜æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸­ï¼Œå¾ˆå¿«å°±ä¼šå˜å¾—ä¸çµä¾¿ã€‚

å¦‚æœæ˜¯appï¼Œåˆ™ä¸€èˆ¬éƒ½ä¼šåœ¨appçš„templatesæ–‡ä»¶ä¸‹åˆ›å»ºä¸€ä¸ªè·Ÿappåå­—ç›¸åŒçš„æ–‡ä»¶å¤¹ï¼ŒæŠŠæ¨¡æ¿æ–‡ä»¶éƒ½æ”¾åˆ°è¯¥æ–‡ä»¶å¤¹ä¸‹ï¼Œé¿å…æ¨¡æ¿é—´çš„å†²çªã€‚

```python
return render(request, 'dateapp/current_datetime.html', {'current_date': now})
```



## 3.10 include æ¨¡æ¿æ ‡ç­¾



å†…ç½®æ¨¡æ¿æ ‡ç­¾äº†ï¼š {% include %} ã€‚

è¿™ä¸ªæ ‡ç­¾çš„ä½œç”¨æ˜¯å¼•å…¥å¦ä¸€ä¸ªæ¨¡æ¿çš„å†…å®¹ã€‚

å®ƒçš„å‚æ•°æ˜¯è¦å¼•å…¥çš„æ¨¡æ¿çš„åç§°ï¼Œå¯ä»¥æ˜¯å˜é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯ç¡¬ç¼–ç çš„å­—ç¬¦ä¸²ï¼ˆæ”¾åœ¨å¼•å·é‡Œï¼Œå•åŒå¼•å·éƒ½è¡Œï¼‰ã€‚

åªè¦æƒ³åœ¨å¤šä¸ªæ¨¡æ¿ä¸­ä½¿ç”¨ç›¸åŒçš„ä»£ç ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ {% include %} ï¼Œå»é™¤é‡å¤ã€‚

ç”¨æ³•ï¼š{% include template_name %}

```Python
{% include 'includes/nav.html' %}
```





## 3.11 æ¨¡æ¿ç»§æ‰¿



æ¨¡æ¿ä¸€èˆ¬éƒ½ä¼šå­˜åœ¨å¤§é‡çš„é‡å¤çš„ä»£ç ï¼Œæ‰€ä»¥æ¨¡æ¿çš„ç»§æ‰¿æ˜¯å¾ˆå¿…è¦çš„ã€‚

ç”¨æ³•ï¼š

1. åˆ›å»ºä¸€ä¸ªåŸºæ¨¡æ¿ï¼Œå¹¶åœ¨å¯¹åº”çš„åœ°æ–¹æŒ–ç©ºï¼Œæä¾›ç»™å­æ¨¡æ¿å¡«å†…å®¹ã€‚

```python
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en">
    <head>
        <title>{% block title %}{% endblock %}</title>
    </head>
    <body>
        <h1>My helpful timestamp site</h1>
        {% block content %}{% endblock %}
        {% block footer %}
            <hr>
            <p>Thanks for visiting my site.</p>
        {% endblock %}
    {% block js %}{% endblock %}
    </body>
</html>
```

2. å­æ¨¡æ¿ç»§æ‰¿çˆ¶æ¨¡æ¿ï¼Œå¹¶åœ¨å¯¹åº”çš„ç©ºå¡«å†…å®¹

```python
{% extends "base.html" %}

{% block title %}The current time{% endblock %}
{% block content %}
	<p>It is now {{ current_date }}.</p>
{% endblock %}
```



æ³¨æ„ï¼š

	1.  {% extends %}å¿…é¡»æ”¾åœ¨æœ€é¡¶éƒ¨
 	2.  åŸºæ¨¡æ¿ä¸­çš„ {% block %} æ ‡ç­¾è¶Šå¤šè¶Šå¥½ã€‚å­æ¨¡æ¿æ— éœ€å®šä¹‰çˆ¶æ¨¡æ¿ä¸­çš„å…¨éƒ¨å—
 	3.  å½“å‡ºç°è¿‡å¤šçš„é‡å¤çš„ä»£ç æ—¶ï¼Œå°±åº”è¯¥è€ƒè™‘åœ¨åŸºæ¨¡æ¿æŒ–ç©ºäº†
 	4.   {% block %}çš„åç§°ä¸èƒ½åŒå





# 4 Djangoæ¨¡å‹









































# 5 Djangoç®¡ç†åå°



## 5.1 åˆ›å»ºè¶…çº§ç”¨æˆ·



```python
python manage.py createsuperuser
```



## 5.2 ç®¡ç†åå°è¿è¡ŒåŸç†



```
1. å¯åŠ¨æœåŠ¡å™¨æ—¶ï¼ŒDjango è¿è¡Œ admin.autodiscover() å‡½æ•°ã€‚è¦åœ¨ urls.py æ–‡ä»¶ä¸­è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯ç°åœ¨ç‰ˆæœ¬çš„ Django ä¼šè‡ªåŠ¨è¿è¡Œå®ƒã€‚

2. autodiscover()å‡½æ•°è¿­ä»£ INSTALLED_APPS è®¾ç½®ï¼Œåœ¨å®‰è£…çš„å„ä¸ªåº”ç”¨ä¸­æŸ¥æ‰¾ä¸€ä¸ªåä¸º admin.py çš„æ–‡ä»¶ã€‚

3. å¦‚æœåº”ç”¨ä¸­å­˜åœ¨è¿™ä¸ªæ–‡ä»¶ï¼Œå°±æ‰§è¡Œé‡Œé¢çš„ä»£ç ã€‚è°ƒç”¨ admin.site.register() ï¼Œåœ¨ç®¡ç†åå°ä¸­æ³¨å†Œå„ä¸ªæ¨¡å‹ï¼Œå°±å¯ä»¥åœ¨åå°æ˜¾ç¤ºäº†ã€‚

4. åå°ç®¡ç†åœ¨ django/contrib/admin é‡Œçš„ä»£ç ï¼ŒæŸ¥çœ‹å®ƒçš„æ¨¡æ¿ã€è§†å›¾å’Œ URL é…ç½®ã€‚

5. ç®¡ç†åå°çš„å¤„ç†ç›¸å½“å¤æ‚ï¼Œç†è§£èµ·æ¥æŒºè´¹åŠ²ã€‚
```



## 5.3 æŠŠæ¨¡å‹æ·»åŠ åˆ° Django ç®¡ç†åå°ä¸­



```python
from django.contrib import admin
from app.models import Book

admin.site.register(Book)
```





# 6 Djangoè¡¨å•





## 6.1 å…³äºURLçš„ä¿¡æ¯



è§†å›¾å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»ä¸ºHttpRequest ã€‚

```python
def index(request):
	return HttpResponse("Welcome to the page at %s" % request.path)
```



 HttpRequest å¯¹è±¡çš„æ–¹æ³•å’Œå±æ€§

| å±æ€§/æ–¹æ³•               | è¯´æ˜                                    | ç¤ºä¾‹                                 |
| ----------------------- | --------------------------------------- | ------------------------------------ |
| request.path            | å®Œæ•´çš„è·¯å¾„ï¼Œä¸å«åŸŸåï¼Œä½†æ˜¯åŒ…å«å‰å¯¼æ–œçº¿  | /hello/                              |
| request.get_host()      | ä¸»æœºå                                  | â€œ127.0.0.1:8000â€æˆ–â€œwww.exam-ple.comâ€ |
| request.get_full_path() | åŒ…å«æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰çš„è·¯å¾„      | /hello/?print=true                   |
| request.is_secure()     | é€šè¿‡ HTTPS è®¿é—®æ—¶ä¸º True ï¼Œå¦åˆ™ä¸º False | True æˆ– False                        |





## 6.2 è¡¨å•éªŒè¯



è¡¨å•ç±»çš„å­—æ®µå‚æ•°æ•¢æ•°æ®æ¨¡å‹å¾ˆåƒã€‚



```python
from django import forms

class ContactForm(forms.Form):
    """Formç±»"""
    
    subject = forms.CharField(max_length=10)
    email = forms.EmailField(required=False, label='Your e-mail address')
    message = forms.CharField()
    
    def clean_message(self):
        """è‡ªå®šä¹‰éªŒè¯å­—æ®µé’©å­å‡½æ•°"""
        
        message = self.cleaned_data['message']
        num_words = len(message.split())
        if num_words < 4:
        	raise forms.ValidationError("Not enough words!")
        return message


def contact(request):
    """è§†å›¾å‡½æ•°"""
    
    if request.method == 'POST':
    	form = ContactForm(request.POST)
        
    if form.is_valid():
        cd = form.cleaned_data
        send_mail(
            cd['subject'],
            cd['message'],
            cd.get('email', 'noreply@example.com'),['siteowner@example.com'],
        )
        return HttpResponseRedirect('/contact/thanks/')
    else:
        form = ContactForm()
    return render(request, 'contact_form.html', {'form': form})

```





# 7 é«˜çº§è§†å›¾å’ŒURLé…ç½®





## 7.1 ç®€åŒ–å¯¼å…¥



- åˆ†å¼€å¯¼å…¥æ¨¡å‹

```python
from django.conf.urls import include, url
from django.contrib import admin
from mysite.views import hello, current_datetime, hours_ahead


urlpatterns = [
    url(r'^admin/', include(admin.site.urls)),
    url(r'^hello/$', hello),
    url(r'^time/$', current_datetime),
    url(r'^time/plus/(\d{1,2})/$', hours_ahead),
]

```



- å¯¼å…¥æ•´ä¸ªæ¨¡å—ï¼ˆæ¨èï¼‰

```python
from django.conf.urls import include, url
from app import views

urlpatterns = [
    url(r'^hello/$', views.hello),
    url(r'^time/$', views.current_datetime),
    url(r'^time/plus/(d{1,2})/$', views.hours_ahead),
]
```



## 7.2 å…·ååˆ†ç»„





- æ™®é€šURL

```python
from django.conf.urls import url
from app import views

urlpatterns = [
    url(r'^reviews/2003/$', views.special_case_2003),
    url(r'^reviews/([0-9]{4})/$', views.year_archive),
    url(r'^reviews/([0-9]{4})/([0-9]{2})/$', views.month_archive),
    url(r'^reviews/([0-9]{4})/([0-9]{2})/([0-9]+)/$', views.review_detail),
]
```



- å…·åURL

```python
from django.conf.urls import url
from app import views

urlpatterns = [
    url(r'^reviews/$', views.page),
    url(r'^reviews/page(?P<num>[0-9]+)/$', views.page),
]


# åˆ™è§†å›¾å‡½æ•°
def index(request, num):
    """å¦‚æœnumä¸å†™ï¼Œä¼šæŠ¥é”™"""
    pass

# ä¹Ÿå¯ä»¥è®¾ç½®é»˜è®¤å€¼
def index(request, num=1):
    pass
```





## 7.3 å¼•å…¥å…¶ä»– URL é…ç½®



å› ä¸ºä¸€ä¸ªé¡¹ç›®åŒ…å«å¤šä¸ªappï¼Œæ‰€ä»¥éœ€è¦å¼•å…¥å…¶ä»–çš„URLã€‚

```python
from django.conf.urls import include, url

urlpatterns = [
    url(r'^community/', include('app.urls')),
    url(r'^contact/', include('app.urls')),
]

```



æ³¨æ„ï¼Œè¿™é‡Œçš„æ­£åˆ™è¡¨è¾¾å¼æ²¡æœ‰ $ ï¼ˆåŒ¹é…å­—ç¬¦ä¸²æœ«å°¾çš„ç¬¦å·ï¼‰ï¼Œä½†æ˜¯æœ«å°¾æœ‰æ–œçº¿ã€‚

Django é‡åˆ° include() æ—¶ï¼Œä¼šæŠŠæˆªè‡³é‚£ä¸€ä½ç½®åŒ¹é…çš„ URL æˆªæ–­ï¼ŒæŠŠä½™ä¸‹çš„å­—ç¬¦ä¸²ä¼ ç»™å¼•å…¥å®ƒçš„ URL é…ç½®ï¼Œåšè¿›ä¸€æ­¥å¤„ç†ã€‚



æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ url() å¼•å…¥é¢å¤–çš„ URL æ¨¡å¼ã€‚

å¯ä»¥å»é™¤ URL é…ç½®ä¸­çš„é‡å¤ï¼Œåœ¨å¤šå¤„ä½¿ç”¨ç›¸åŒçš„æ¨¡å¼å‰ç¼€ã€‚

```python
from django.conf.urls import include, url
from apps.main import views as main_views
from credit import views as credit_views


extra_patterns = [
    url(r'^reports/(?P<id>[0-9]+)/$', credit_views.report),
    url(r'^charge/$', credit_views.charge),
]

urlpatterns = [
    url(r'^$', main_views.homepage),
    url(r'^help/', include('apps.help.urls')),
    # æ‰©å±•url
    url(r'^credit/', include(extra_patterns)),
]
```





å¼•å…¥appçš„urls.pyï¼Œä¸€èˆ¬è¿™æ ·å°±å¤Ÿäº†ã€‚

```python
urlpatterns = [
    url(r'^app/', include(('app.urls', 'app'), namespace='app')),
]

è¯´æ˜ï¼š
	1. include(('appçš„urls.py', 'åº”ç”¨åç§°'), namespace='å‘½åç©ºé—´å')
```







## 7.4  åå‘è§£æ URL



æ ¹çš„urls.py

```python
urlpatterns = [
    url(r'^user/', include(('user.urls', 'user'), namespace='user')),
] 
```



appçš„urls.py

```python
urlpatterns = [
    url(r'^login/$', view.login, name='login'),
]
```



**åˆ™ä½¿ç”¨urlæ–¹å‘è§£ææ—¶**

```python
# åœ¨è§†å›¾å‡½æ•°
reverse('user:login')
# ä¼ é€’å‚æ•°å¯ä»¥
reverse('user:login', kwargs={'user_id':10, 'page': 2, ...})

# åœ¨æ¨¡æ¿
{% url 'user:login' %}
# ä¼ é€’å‚æ•°å¯ä»¥
{% url 'user:login' urser_id=1 page=2 ... %}

è¯´æ˜ï¼š
	1. reverse('appå‘½åç©ºé—´:urlå‘½å')
    2. {% url 'appå‘½åç©ºé—´:urlå‘½å' %}
    3. è¦æ˜¯æœ‰å¤šçº§å‘½åç©ºé—´å°±
    	'name1:name2:...:url_name'
        æ¥ä¸‹å»å°±è¡Œäº†ï¼Œä½†æ˜¯ä¸€èˆ¬çš„éƒ½ä¸ä¼šå¤ªé•¿ã€‚
```

















# 8 é«˜çº§æ¨¡æ¿æŠ€æœ¯



ç°åœ¨å‰åç«¯åˆ†ç¦»æ˜¯è¶‹åŠ¿ï¼Œè¦æ˜¯ä½ å†³å¿ƒæçš„å°±æ˜¯å‰ååˆ†ç¦»ï¼Œé‚£å°±å¯ä»¥ä¸ç”¨æ·±å…¥å­¦Djangoæ¨¡æ¿è¿™éƒ¨åˆ†äº†ã€‚

ä¸è¿‡ç°åœ¨ä¸€äº›å…¬å¸å†…éƒ¨è¿˜æ˜¯ä½¿ç”¨ä¸åˆ†ç¦»çš„ï¼Œå›¾çš„å°±æ˜¯å¿«é€Ÿå¼€å‘ã€‚

ä¸è¿‡åœ¨å­¦ä¹ çš„è§’åº¦ï¼ŒDjangoçš„æ¨¡æ¿æœºåˆ¶è®¾è®¡å¾—å¾ˆä¼˜ç§€çš„ï¼Œå€¼å¾—å­¦ä¹ ã€‚





æ¨¡æ¿ä¸­æœ‰æ¨¡æ¿æ ‡ç­¾å’Œå˜é‡ã€‚

- æ¨¡æ¿æ ‡ç­¾ä½¿ç”¨{% tag_name %}
- æ¨¡æ¿å˜é‡ä½¿ç”¨{{ arg_name }}



## 8.1 RequestContext å’Œä¸Šä¸‹æ–‡å¤„ç†å™¨



æ¨¡æ¿è¦åœ¨ä¸Šä¸‹æ–‡ä¸­æ¸²æŸ“ã€‚

ä¸Šä¸‹æ–‡æ˜¯ django.template.Context çš„å®ä¾‹ï¼Œä¸è¿‡ Django è¿˜æä¾›ä¸€ä¸ªå­ç±»ï¼Œ django.template.RequestContext ï¼Œå…¶è¡Œä¸ºç¨æœ‰ä¸åŒã€‚

RequestContext é»˜è®¤ä¸ºæ¨¡æ¿ä¸Šä¸‹æ–‡æ·»åŠ å¾ˆå¤šå˜é‡ã€‚

ä½¿ç”¨ render() å¿«æ·æ–¹å¼æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ˜ç¡®ä¼ å…¥å…¶ä»–ä¸Šä¸‹æ–‡ï¼Œé»˜è®¤ä½¿ç”¨ RequestContextã€‚



 context_processors è®¾ç½®ï¼ˆåœ¨ settings.py æ–‡ä»¶ä¸­ï¼‰æŒ‡æ˜å§‹ç»ˆæä¾›ç»™ RequestContext çš„ä¸Šä¸‹æ–‡å¤„ç†å™¨ã€‚

```python
context_processors çš„é»˜è®¤å€¼å¦‚ä¸‹ï¼š

'context_processors': [
    'django.template.context_processors.debug',
    'django.template.context_processors.request',
    'django.contrib.auth.context_processors.auth',
    'django.contrib.messages.context_processors.messages',
],
```



### 8.1.1 auth



django.contrib.auth.context_processors.auth

å¯ç”¨è¿™ä¸ªå¤„ç†å™¨åï¼Œ RequestContext ä¸­å°†åŒ…å«ä¸‹è¿°å˜é‡ï¼š

- user ï¼š auth.User çš„å®ä¾‹ï¼Œè¡¨ç¤ºå½“å‰ç™»å½•çš„ç”¨æˆ·ï¼ˆå¦‚æœªç™»å½•ï¼Œæ˜¯ AnonymousUser å®ä¾‹ï¼‰ã€‚
- perms ï¼š django.contrib.auth.context_processors.PermWrapper å®ä¾‹ï¼Œè¡¨ç¤ºå½“å‰ç™»å½•ç”¨æˆ·æ‹¥æœ‰çš„æƒé™ã€‚





## 8.2 æ¨¡æ¿åŠ è½½å†…éƒ¨æœºåˆ¶



é€šå¸¸æŠŠæ¨¡æ¿ä¿å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶é‡Œï¼Œè€Œä¸ç›´æ¥ä½¿ç”¨ä½å±‚çš„ Template APIã€‚



- DIRS é€‰é¡¹

  åœ¨settings.pyé‡Œé¢æœ‰å¦‚ä¸‹é…ç½®

```python
TEMPLATES = [
{
    'BACKEND': 'django.template.backends.django.DjangoTemplates',
    # è¿™æ ·é…ç½®ï¼Œæ­£å¸¸çš„å°±æ˜¯åœ¨æ ¹ç›®å½•ä¸‹çš„templatesä¸‹æ‰¾æ¨¡æ¿æ–‡ä»¶ï¼Œæ‰¾ä¸åˆ°å°±å»appä¸‹é¢æ‰¾
    'DIRS':  [os.path.join(BASE_DIR, 'templates')],
    },
]

è¯´æ˜ï¼š
	1. appæ¨¡æ¿çš„æŸ¥æ‰¾é¡ºåºè·Ÿappæ³¨å†Œçš„é¡ºåºä¸€è‡³
    2. å¦‚æœå‰é¢çš„appæœ‰ä½ ç°åœ¨è¿™ä¸ªappè¦ç”¨çš„æ¨¡æ¿ï¼Œåˆ™ä¼šå…ˆç”¨å‰é¢çš„ï¼Œè€Œä¸æ˜¯æœ¬appçš„
    3. æ‰€ä»¥ï¼Œä¸€éçœŸappçš„templatesä¸‹å†åˆ›å»ºä¸€ä¸ªè·ŸappåŒåçš„æ–‡ä»¶å¤¹ï¼ŒæŠŠappæ‰€æœ‰çš„æ¨¡æ¿æ–‡ä»¶éƒ½æ”¾é‡Œé¢
```



ç†è®ºä¸Šï¼Œæ¨¡æ¿æ–‡ä»¶å¯ä»¥æ”¾åœ¨ä»»ä½•åœ°æ–¹ï¼ŒæœåŠ¡å™¨æ‰¾å¾—åˆ°è¿›è¡Œï¼Œæ¨¡æ¿æ–‡ä»¶çš„åç¼€ä¸ä¸€å®šè¦.htmlï¼Œå¯ä»¥ä»»æ„ï¼Œä¸å†™ä¹Ÿè¡Œã€‚

ä½†æ˜¯ï¼Œå¼€å‘è¿˜æ˜¯å¾—æ ¹æ®è§„èŒƒæ¥ï¼Œæ¨¡æ¿éƒ½æ”¾ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåç¼€éƒ½ç”¨.htmlã€‚

æ­¤å¤–è¿˜è¦æ³¨æ„ï¼š

â€‹	Unixç±»ç³»ç»Ÿçš„è·¯å¾„åˆ†éš”ç¬¦æ˜¯ /

â€‹	winç³»ç»Ÿçš„æ˜¯\



è¾ƒå®Œæ•´çš„é…ç½®é•¿è¿™æ ·çš„ï¼š

```python
TEMPLATES = [
    {
        # ä½¿ç”¨çš„æ¨¡æ¿ç³»ç»Ÿ
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        # æ¨¡æ¿æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œæ˜¯åˆ—è¡¨ï¼Œæ‰€ä»¥å¯ä»¥æœ‰å¤šä¸ªåœ°æ–¹
        'DIRS': [os.path.join(BASE_DIR, 'templates'), ],
        # é…ç½®è¿™ä¸ªï¼Œå¦‚æœDIRSæ‰¾ä¸åˆ°æ¨¡æ¿ï¼Œå°±æ ¹æ®é¡ºåºåˆ°appä¸‹æ‰¾ï¼Œå†æ‰¾ä¸åˆ°å°±æŠ¥é”™
        'APP_DIRS': True,
        # å‚æ•°é€‰é¡¹é…ç½®
        'OPTIONS': {
            # ä¸Šä¸‹æ–‡ç®¡ç†å™¨é…ç½®ï¼Œä½¿ç”¨é‚£äº›å¤„ç†å™¨åœ¨è¿™é‡Œé…ç½®ï¼Œè¿™æ ·æ¨¡æ¿å°±æœ‰äº†ç›¸å…³çš„å¯¹è±¡
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]
```



## 8.3 æ‰©å±•æ¨¡æ¿ç³»ç»Ÿ



å¯¹æ¨¡æ¿ç³»ç»Ÿçš„å®šåˆ¶ï¼ŒåŸºæœ¬ä¸Šæ˜¯è‡ªå®šä¹‰æ¨¡æ¿æ ‡ç­¾å’Œï¼ˆæˆ–ï¼‰è¿‡æ»¤å™¨ã€‚





### 8.3.1 è‡ªå®šä¹‰æ¨¡æ¿ç³»ç»Ÿçš„ç›®å½•ç»“æ„



è‡ªå®šä¹‰çš„æ¨¡æ¿æ ‡ç­¾å’Œè¿‡æ»¤å™¨å¿…é¡»æ”¾åœ¨ä¸€ä¸ª Django åº”ç”¨ä¸­ã€‚

å¦‚æœä¸ç°æœ‰åº”ç”¨æœ‰å…³ï¼Œå¯ä»¥æ”¾åœ¨ç°æœ‰åº”ç”¨ä¸­ã€‚

å¦åˆ™ï¼Œåº”è¯¥ä¸“é—¨åˆ›å»ºä¸€ä¸ªåº”ç”¨å­˜æ”¾ã€‚

åº”ç”¨ä¸­åº”è¯¥æœ‰ä¸ª templatetags ç›®å½•ï¼Œä¸ models.py ã€ views.py ç­‰æ–‡ä»¶æ”¾åœ¨åŒä¸€çº§ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ªã€‚



æ·»åŠ è¿™ä¸ªæ¨¡å—ä¹‹åï¼Œè¦é‡å¯æœåŠ¡å™¨æ–¹èƒ½åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„æ ‡ç­¾æˆ–è¿‡æ»¤å™¨ã€‚

è‡ªå®šä¹‰çš„æ ‡ç­¾å’Œè¿‡æ»¤å™¨åœ¨ templatetags ç›®å½•é‡Œçš„ä¸€ä¸ªæ¨¡å—ä¸­ã€‚

æ¨¡å—æ–‡ä»¶çš„åç§°æ˜¯**åŠ è½½æ ‡ç­¾**æ‰€ç”¨çš„åç§°ï¼Œåˆ«ä¸å…¶ä»–åº”ç”¨ä¸­çš„è‡ªå®šä¹‰æ ‡ç­¾å’Œè¿‡æ»¤å™¨å†²çªäº†ã€‚



å‡å¦‚è‡ªå®šä¹‰çš„æ ‡ç­¾ï¼ˆè¿‡æ»¤å™¨ï¼‰æ”¾åœ¨ review_extras.py æ–‡ä»¶ä¸­ï¼Œåº”ç”¨çš„å¸ƒå±€å¯èƒ½æ˜¯ä¸‹é¢è¿™æ ·ï¼š

```python
# reviewsæ˜¯ä¸€ä¸ªapp
reviews/
    __init__.py
    models.py
    templatetags/
    	__init__.py
    	review_extras.py
	views.py
```

åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨

```python
{% load review_extras %}
```



æ³¨æ„ï¼š

â€‹	1. åŒ…å«è‡ªå®šä¹‰æ ‡ç­¾çš„åº”ç”¨å¿…é¡»åœ¨ INSTALLED_APPS ä¸­åˆ—å‡ºï¼Œè¿™æ · {% load %} æ ‡ç­¾æ‰èƒ½èµ·ä½œç”¨ã€‚

	2. å†å¤šçš„ä¾‹å­ä¹Ÿä¸å¦‚é˜…è¯»æºç ï¼Œå­¦ä¹  Django æ˜¯å¦‚ä½•å®šä¹‰é»˜è®¤çš„è¿‡æ»¤å™¨å’Œæ ‡ç­¾çš„ã€‚
 	3. è¿‡æ»¤å™¨å’Œæ ‡ç­¾åˆ†åˆ«åœ¨ django/template/defaultfilters.py å’Œ django/template/defaulttags.py æ–‡ä»¶ä¸­ã€‚



### 8.3.2 åˆ›å»ºæ¨¡æ¿åº“



ç°åœ¨ç‰ˆæœ¬çš„Djangoåˆ›å»ºappæ—¶å·²ç»å¸®æˆ‘ä»¬åˆ›å»ºå¥½äº†ã€‚



ä¸ç®¡æ˜¯è‡ªå®šä¹‰æ ‡ç­¾è¿˜æ˜¯è¿‡æ»¤å™¨ï¼Œç¬¬ä¸€ä»¶äº‹éƒ½æ˜¯åˆ›å»ºæ¨¡æ¿åº“â€”â€”è¿™æ˜¯è®© Django å‹¾ä½çš„åŸºæœ¬è¦æ±‚ã€‚

åˆ›å»ºæ¨¡æ¿åº“åˆ†ä¸ºä¸¤æ­¥ï¼š

- æŠŠæ¨¡æ¿åº“æ”¾åœ¨å“ªä¸ªappä¸­ï¼Œå¹¶æŠŠæ¨¡æ¿åº“æ‰€åœ¨çš„appåŠ åˆ°INSTALLED_APPSä¸­ã€‚
- åœ¨ Django åº”ç”¨ä¸­åˆé€‚çš„åŒ…é‡Œåˆ›å»º templatetags **åŒ…**ï¼Œä¸ models.py ã€ views.pyã€‚



æ ‡ç­¾å’Œè¿‡æ»¤å™¨éƒ½é€šè¿‡è¿™ç§æ–¹å¼æ³¨å†Œï¼Œåœ¨æ¨¡å—é¡¶éƒ¨è¦æ’å…¥ä»£ç ï¼š

```python
from django import template

register = template.Library()
```



### 8.3.3 è‡ªå®šä¹‰æ¨¡æ¿æ ‡ç­¾å’Œè¿‡æ»¤å™¨



ä½¿ç”¨ Python è‡ªå®šä¹‰æ ‡ç­¾å’Œè¿‡æ»¤å™¨ï¼Œç„¶åä½¿ç”¨ {% load %} æ ‡ç­¾åŠ è½½ï¼Œè®©è‡ªå®šä¹‰çš„æ ‡ç­¾å’Œè¿‡æ»¤å™¨å¯åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ã€‚



```python
# ä¼ ç»™ foo è¿‡æ»¤å™¨çš„å˜é‡æ˜¯ var ï¼Œå‚æ•°æ˜¯ "bar" ã€‚
{{ var|foo:"bar" }}
```

æ¨¡æ¿è¯­è¨€æ²¡æœ‰æä¾›å¼‚å¸¸å¤„ç†åŠŸèƒ½ï¼Œæ‰€ä»¥æ¨¡æ¿è¿‡æ»¤å™¨æŠ›å‡ºçš„å¼‚å¸¸ä¼šä»¥æœåŠ¡å™¨é”™è¯¯ä½“ç°å‡ºæ¥ã€‚



#### è‡ªå®šä¹‰æ¨¡æ¿è¿‡æ»¤å™¨

è¿‡æ»¤å™¨æœ¬è´¨æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæœ‰å‡½æ•°æ‰€ç”¨çš„ç‰¹æ€§ã€‚

```python
# å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨
def cut(value, arg):
	return value.replace(arg, '')

def lower(value):
	return value.lower()

# æ³¨å†Œè¿‡æ»¤å™¨
from django import template
register = template.Library()
register.filter('cut', cut)
register.filter('lower', lower)

# åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨
{{ var|cut:"0" }}
{{ var|lower }}

```

å¦ä¸€ç§æ³¨å†Œæ–¹å¼æ˜¯è£…é¥°å™¨çš„å½¢å¼

```python
@register.filter(name='cut')
def cut(value, arg):
	return value.replace(arg, '')
```



#### è‡ªå®šä¹‰æ¨¡æ¿æ ‡ç­¾



##### ç®€å•æ ‡ç­¾ï¼šsimple_tag



å¾ˆå¤šæ¨¡æ¿æ ‡ç­¾æ¥å—å‡ ä¸ªå‚æ•°ï¼ˆå­—ç¬¦ä¸²æˆ–æ¨¡æ¿å˜é‡ï¼‰ï¼Œå¯¹è¾“å…¥å‚æ•°å’Œä¸€äº›å¤–éƒ¨ä¿¡æ¯åšäº›å¤„ç†ä¹‹åè¿”å›ä¸€ä¸ªç»“æœã€‚



ä¾‹å­ï¼š

```python
import datetime
from django import template

register = template.Library()

@register.simple_tag
def current_time(format_string):
	return datetime.datetime.now().strftime(format_string)
```

å¦‚æœæ¨¡æ¿æ ‡ç­¾éœ€è¦è®¿é—®å½“å‰ä¸Šä¸‹æ–‡ï¼Œæ³¨å†Œæ ‡ç­¾æ—¶æŒ‡å®š takes_context å‚æ•°ï¼š

```python
# ç¬¬ä¸€ä¸ªå‚æ•°çš„åç§°å¿…é¡»æ˜¯ context
@register.simple_tag(takes_context=True)
def current_time(context, format_string):
    
	timezone = context['timezone']
	return your_get_current_time_method(timezone, format_string)
```



ä½¿ç”¨ simple_tag è£…é¥°çš„å‡½æ•°å¯ä»¥æ¥å—ä»»æ„ä¸ªä½ç½®å‚æ•°å’Œå…³é”®å­—å‚æ•°ã€‚

```python
# æ ‡ç­¾çš„å®šä¹‰
@register.simple_tag
def my_tag(name, age, *args, **kwargs):
    
    user = User.objects.filter(name=name).first()
    if user.age == int(age):
        return True
    return False


# æ¨¡æ¿ä¸­ä½¿ç”¨
{% my_tag 'ydc' 20 user.address phone='110' %}

è¯´æ˜ï¼š
	1. ä»¥ç©ºæ ¼åˆ†å¼€ç»™æ ‡ç­¾ä¼ é€’å‚æ•°
    2. å…³é”®å­—å‚æ•°è¦å†™åœ¨æœ€åé¢ï¼Œè·ŸPythonå‡½æ•°ä¸€æ ·çš„
```



##### å¼•å…¥æ ‡ç­¾ï¼šinclusion_tag



æ¨¡æ¿æ ‡ç­¾å¦ä¸€ç§å¸¸è§çš„ç”¨æ³•æ˜¯ç”¨äºå¼•å…¥å¦ä¸€ä¸ªæ¨¡æ¿ã€‚



ä¾‹å­ï¼šç¼–å†™ä¸€ä¸ªæ ‡ç­¾ï¼Œç”ŸæˆæŒ‡å®šAuthor å¯¹è±¡åä¸‹çš„å›¾ä¹¦åˆ—è¡¨ã€‚

```html
{% books_for_author author %}

å¾—åˆ°ä¸‹é¢

<ul>
    <li>The Cat In The Hat</li>
    <li>Hop On Pop</li>
    <li>Green Eggs And Ham</li>
</ul>
```

```python
# å®šä¹‰å‡½æ•°.py
def books_for_author(author):
    books = Book.objects.filter(authors__id=author.id)
    return {'books': books}

# å®šä¹‰æ¨¡æ¿book_snippet.html
<ul>
    {% for book in books %}
    	<li>{{ book.title }}</li>
    {% endfor %}
</ul>

@register.inclusion_tag('book_snippet.html')
def show_reviews(review):
    pass

# åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨
{% books_for_author author %}
```























# 9 Django æ¨¡å‹çš„é«˜çº§ç”¨æ³•





## 9.1 ç›¸å…³æ¨¡å‹å¯¹è±¡



```python
from django.db import models

class Publisher(models.Model):
    """å‡ºç‰ˆç¤¾"""
    
    name = models.CharField(max_length=30)
    address = models.CharField(max_length=50)
    city = models.CharField(max_length=60)
    state_province = models.CharField(max_length=30)
    country = models.CharField(max_length=50)
    website = models.URLField()
    
    def __str__(self):
    	return self.name
    
class Author(models.Model):
    """ä½œè€…"""
    
    first_name = models.CharField(max_length=30)
    last_name = models.CharField(max_length=40)
    email = models.EmailField()
    
    def __str__(self):
    	return '%s %s' % (self.first_name, self.last_name)
    
class Book(models.Model):
    """å›¾ä¹¦"""
    
    title = models.CharField(max_length=100)
    # å¤šå¯¹å¤š
    authors = models.ManyToManyField(Author)
    # ä¸€å¯¹å¤šï¼šä¸€ä¸ªå‡ºç‰ˆç¤¾å¯ä»¥å‡ºç‰ˆå¤šæœ¬ä¹¦
    publisher = models.ForeignKey(Publisher)
    publication_date = models.DateField()
    
    def __str__(self):
    	return self.title
```



### 9.1.1 æŸ¥è¯¢æ•°æ®



ä»¥bookä¸ºä¾‹

æ›´å¤šæŸ¥è¯¢è¯¦ç»†ï¼Œ:point_right:django2.2ä¸­æ–‡æ–‡æ¡£ç›®å½• https://docs.djangoproject.com/zh-hans/2.2/

:point_right:(æŸ¥è¯¢æ¥å£ï¼Œä»€ä¹ˆæŸ¥è¯¢éƒ½æµé‡Œé¢)https://docs.djangoproject.com/zh-hans/2.2/ref/models/querysets/#q-objects

```python
# 1. è·å–æ‰€æœ‰å›¾ä¹¦
book_list = Book.objects.all()

# 2. è·å–ä¸€æœ¬å›¾ä¹¦ï¼Œå¦‚æœå¯¹åº”idçš„ä¹¦ä¸å­˜åœ¨ï¼Œåˆ™æŠ¥é”™
book = Book.objects.get(id=1)

# 3. è·å–ä¸€æœ¬ä¹¦ï¼Œè¿”å›ä¸€ä¸ªquerysetå¯¹è±¡ï¼Œå¦‚æœæ²¡åˆ™è¿”å›None
book = Book.objects.filter(id=1).first()

# 4. è·å–titleåŒ…å« py çš„æ‰€æœ‰ä¹¦ç±, ä¸‹é¢ä¸¤å¥æ˜¯ç­‰ä»·çš„ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨ç¬¬ä¸€å¥çš„å½¢å¼
book = Book.objects.filter(title='python3').all()
book = Book.objects.filter(title__exact='python3').all()

# ä¸åŒºåˆ†å¤§å°å†™
book = Book.objects.filter(title__iexact='python3').all()

# 5. è·å–titleåŒ…å« py çš„æ‰€æœ‰ä¹¦ç±
book = Book.objects.filter(title__contains='py').all()

# 6. æ¡ä»¶è¡¨è¾¾å¼ï¼Œç­›é€‰titleåŒ…å« py æˆ– ä»¥pyå¼€å¤´çš„ä¹¦
book_list = Book.objects.filter(Q(title__contains='py') | Q(title__startswith='py'))

...
```



### 9.1.2 è®¿é—®å¤–é”®å€¼



é¦–å…ˆå¾—çŸ¥é“å…³è”å…³ç³»ã€‚

è¿™é‡Œï¼šä¹¦æ˜¯å¤šæ–¹ï¼Œå‡ºç‰ˆç¤¾æ˜¯ä¸€æ–¹ï¼Œç®¡ç†å­—æ®µåœ¨ä¹¦æ–¹å»ºç«‹ã€‚

- æ­£å‘è®¿é—®

```python
# ç¬¬ä¸€æ­¥ï¼šè·å–bookå¯¹è±¡
book = Book.objects.filter(id=1).first()

# ç¬¬äºŒæ­¥ï¼šé€šè¿‡bookå¯¹è±¡è®¿é—® å‡ºç‰ˆç¤¾å¯¹è±¡ï¼ŒåŠå…¶å±æ€§
publisher = book.publisher
p_name = book.publisher.name
```

- åå‘è®¿é—®

```python
# ç¬¬ä¸€æ­¥ï¼šè·å–publisherå¯¹è±¡
publisher = Publisher.objects.filter(id=1).first()

# ç¬¬äºŒæ­¥ï¼šé€šè¿‡publisherå¯¹è±¡ï¼Œè·å–æ‰€æœ‰çš„å›¾ä¹¦
book_list = publisher.book_set.all()

book = Book.objects.filter(id=1).first()
# ç»™å‡ºç‰ˆç¤¾å¢åŠ ä¸€æœ¬ä¹¦
publisher.book_set.add(book)
# åˆ é™¤ä¸€æœ¬ä¹¦
publisher.book_set.remove(book)

è¯´æ˜ï¼š
	1. å› ä¸ºæ¨¡å‹åˆ›å»ºçš„æ—¶å€™æ˜¯:
        publisher = models.ForeignKey(Publisher)
        
       å³æ²¡æœ‰æŒ‡æ˜æ–¹å‘å¼•ç”¨çš„åç§°ï¼Œæ‰€ä»¥fåå‘è®¿é—®æ—¶å°±å¾—ä½¿ç”¨ book_set ï¼š
    	publisher = Publisher.objects.filter(id=1).first()
    	book_list = publisher.book_set.all()
        
    2. å¦‚æœåœ¨æ¨¡å‹åˆ›å»ºçš„æ—¶å€™ï¼Œä½¿ç”¨related_name='books'æŒ‡æ˜ï¼š
    	publisher = models.ForeignKey(to='Publisher', on_delete=models.CASCADE, related_name='books')
        
       åˆ™åå‘è®¿é—®æ—¶å¯ä»¥ï¼š
	    publisher = Publisher.objects.filter(id=1).first()
    	book_list = publisher.books.all()
```



**å…³äºï¼šæ­£å‘è®¿é—®å’Œåå‘è®¿é—®**

- æ­£å‘è®¿é—®ï¼šå…³è”å­—æ®µåœ¨æ¨¡å‹Aï¼Œåˆ™Aæ¨¡å‹çš„å¯¹è±¡é€šè¿‡å…³è”å¯¹è±¡å»è®¿é—®è¢«å…³è”çš„å¯¹è±¡ï¼Œå°±æ˜¯æ­£å‘è®¿é—®ã€‚
- åå‘è®¿é—®ï¼šè¢«å…³è”çš„æ¨¡å‹Bé€šè¿‡ a_setï¼ˆå†…éƒ¨è§„åˆ™ï¼Œæ¨¡å‹çš„å°å†™+_setï¼‰ æˆ– æ¨¡å‹Aè®¾ç½®çš„related_name='related_name'æ¥è®¿é—®çš„ï¼Œå°±æ˜¯åå‘è®¿é—®

 

### 9.1.3 å¤šå¯¹å¤šç›¸å…³è®¿é—®å’Œæ“ä½œ



å¤šå¯¹å¤šçš„æ•°æ“ä½œï¼Œå¤„ç†çš„æ˜¯ QuerySet å€¼ï¼Œè€Œéæ¨¡å‹å®ä¾‹ã€‚



```python
# è·å–ä¸€æœ¬ä¹¦
book = Book.objects.filter(id=1).first()
# è·å–è¿™æœ¬ä¹¦çš„æ‰€æœ‰ä½œè€…
book.authors.all()
# è¿‡æ»¤æ•°æ®ï¼šè·å–first_nameåŒ…å«yçš„ä½œè€…
book.authors.filter(first_name__contains='y')
# å¢åŠ ä¸€ä¸ªä½œè€…
author = Author.objects.create(name='mkaer')
book.authors.add(author)

# åˆ é™¤ä¸€ä¸ªä½œè€…
book.authors.remove(author)
```





## 9.2 ç®¡ç†å™¨



ç®¡ç†å™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ–¹ä¾¿çš„æŸ¥è¯¢æ•°æ®åº“ã€‚

Book.objects.all()ä¸­ï¼Œå±æ€§objectså°±æ˜¯ä¸€ä¸ªç®¡ç†å™¨ï¼Œall()æ˜¯å®ƒçš„ä¸€ä¸ªæ–¹æ³•ã€‚



### 9.2.1 æ·»åŠ é¢å¤–çš„ç®¡ç†å™¨æ–¹æ³•



objectsæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç±»å¯¹è±¡ï¼Œå†…éƒ¨å°è£…äº†å¾ˆå¤šæ“ä½œæ•°æ®åº“çš„æ–¹æ³•ã€‚

```python
class BookManager(models.Manager):
    """
    è‡ªå®šä¹‰å›¾ä¹¦ç®¡ç†å™¨
    è¦ç»§æ‰¿è¿™ä¸ªç±»models.Managerï¼Œé‡Œé¢æœ‰å¾ˆå¤šå°è£…å¥½äº†çš„æ–¹æ³•
    """

    def title_count(self, keyword):
        """æ‰©å±•çš„æ–¹æ³•"""
        
        return self.filter(title__icontains=keyword).count()

class Book(models.Model):
    """å›¾ä¹¦"""

    title = models.CharField(max_length=100)
    # å¤šå¯¹å¤š
    authors = models.ManyToManyField(to='Author', blank=True, null=True)
    # ä¸€å¯¹å¤šï¼šä¸€ä¸ªå‡ºç‰ˆç¤¾å¯ä»¥å‡ºç‰ˆå¤šæœ¬ä¹¦
    publisher = models.ForeignKey(to='Publisher', on_delete=models.CASCADE, related_name='books', blank=True, null=True)
    publication_date = models.DateField(auto_now_add=True)

    num_pages = models.IntegerField(blank=True, null=True)
    # ç®¡ç†å™¨ï¼Œè¿™æ ·å°±å¤šäº†ä¸€ä¸ªtitle_countæ–¹æ³•
    objects = BookManager()

    
# ç”¨çš„æ—¶å€™å°±ï¼š
Book.objects.title_count('python')
```



### 9.2.2 ä¿®æ”¹ç®¡ç†å™¨è¿”å›çš„æŸ¥è¯¢é›†åˆ



ç®¡ç†å™¨çš„åŸºæœ¬æŸ¥è¯¢é›†åˆè¿”å›ç³»ç»Ÿä¸­çš„æ‰€æœ‰å¯¹è±¡ã€‚ä½†æ˜¯å¯ä»¥æ”¹å˜è¿”å›é›†åˆï¼ˆæŒºå°‘è¿™ä¹ˆåšçš„ï¼ŒçŸ¥é“èƒ½è¿™ä¹ˆæå°±è¡Œ...ï¼‰ã€‚



```python
from django.db import models

# é¦–å…ˆï¼Œå®šä¹‰ Manager å­ç±»
class YangBookManager(models.Manager):
    def get_queryset(self):
        # è¿”å›å‰å…ˆè¿‡æ»¤ä¸€æ³¢
    	return super(YangBookManager, self).get_queryset().filter(author='yang')
    
# ç„¶åï¼Œæ”¾å…¥ Book æ¨¡å‹
class Book(models.Model):
    title = models.CharField(max_length=100)
    author = models.CharField(max_length=50)

    objects = models.Manager() # é»˜è®¤çš„ç®¡ç†å™¨
    yang_objects = YangBookManager() # ä¸“é—¨æŸ¥è¯¢ yang çš„ç®¡ç†å™¨
```



## 9.3 æ¨¡å‹æ–¹æ³•



æ¨¡å‹ä¸­è‡ªå®šä¹‰çš„æ–¹æ³•ä¸ºå¯¹è±¡æ·»åŠ æ•°æ®è¡Œå±‚çš„åŠŸèƒ½ã€‚

ç®¡ç†å™¨çš„ä½œç”¨æ˜¯æ‰§è¡Œæ•°æ®è¡¨å±‚çš„æ“ä½œï¼Œå³æ“ä½œæ•°æ®åº“ã€‚

æ¨¡å‹æ–¹æ³•å¤„ç†çš„æ˜¯å…·ä½“çš„æ¨¡å‹å®ä¾‹ï¼Œå³æ“ä½œæ¨¡å‹å¯¹è±¡ã€‚

è¿™ä¸ªæŒºé‡è¦çš„ï¼Œå…¶æ€æƒ³å°±æ˜¯æŠŠä¸šåŠ¡é€»è¾‘ä»£ç éƒ½æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå³æ¨¡å‹ä¸­ï¼ˆå…¬å¸éƒ½è¿™ä¹ˆæ...ï¼‰ã€‚



```python
class Author(models.Model):
    """ä½œè€…"""

    first_name = models.CharField(max_length=30)
    last_name = models.CharField(max_length=40)
    email = models.EmailField(blank=True, null=True)

    def __str__(self):
        return '%s %s' % (self.first_name, self.last_name)
	
    # å®šä¹‰æ¨¡å‹æ–¹æ³•
    def _get_full_name(self):

        # è¿”å›ä¸€ä¸ªäººçš„å…¨å
        return '%s %s' % (self.first_name, self.last_name)
	# æŠŠä¸€ä¸ªæ–¹æ³•å¼„æˆä¸€ä¸ªå±æ€§ï¼Œä½¿ç”¨æ—¶ç›´æ¥author.full_name å°±å¯ä»¥å¾—åˆ°ç»“æœäº†
    full_name = property(_get_full_name)
```



æ¨¡å‹é‡Œé¢æœ‰å¾ˆå¤šæ–¹æ³•éƒ½å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡ï¼Œé‡å†™æˆ–è€…è‡ªå®šä¹‰ã€‚



### 9.3.1 è¦†ç›–é¢„å®šä¹‰çš„æ¨¡å‹æ–¹æ³•



æƒ³æ¨¡å‹çš„å¢åˆ æ”¹æŸ¥éƒ½å·²ç»é¢„å…ˆå®šä¹‰å¥½äº†çš„ã€‚

å¦‚æœè¦åœ¨è¿™äº›æ“ä½œå‰åšä¸€å†™æ“ä½œï¼Œåˆ™å¯ä»¥é‡å†™è¿™äº›æ–¹æ³•ã€‚

```python
class Author(models.Model):
    """ä½œè€…"""

    first_name = models.CharField(max_length=30)
    last_name = models.CharField(max_length=40)
    email = models.EmailField(blank=True, null=True)

    def __str__(self):
        return '%s %s' % (self.first_name, self.last_name)

    def save(self, *args, **kwargs):

        if self.first_name == 'ydc':
            return
        # çœŸæ­£æ‰§è¡Œçš„åœ°æ–¹
        super().save(*args, **kwargs)
```



## 9.4 æ‰§è¡ŒåŸå§‹ SQL





æ¨¡å‹çš„æŸ¥è¯¢ API ä¸å¤Ÿç”¨æ—¶ï¼Œå¯ä»¥ç¼–å†™åŸå§‹ SQLã€‚

Django ä¸ºæ‰§è¡ŒåŸå§‹ SQL æŸ¥è¯¢æä¾›äº†ä¸¤ç§æ–¹å¼ï¼š

â€‹	- ä½¿ç”¨ Manager.raw() æ‰§è¡Œï¼Œè¿”å›æ¨¡å‹å®ä¾‹é›†åˆ

â€‹	- å®Œå…¨ä¸ç”¨æ¨¡å‹å±‚ï¼Œç›´æ¥æ‰§è¡Œè‡ªå®šä¹‰çš„ SQLã€‚



è¿™æ–¹å¼å®¹æ˜“å‘ç”Ÿ SQL æ³¨å…¥æ”»å‡»ã€‚



## 9.5 æ‰§è¡ŒåŸå§‹æŸ¥è¯¢



ç®¡ç†å™¨çš„ raw() æ–¹æ³•ç”¨äºæ‰§è¡ŒåŸå§‹çš„ SQL æŸ¥è¯¢ï¼Œå…¶è¿”å›ç»“æœæ˜¯æ¨¡å‹å®ä¾‹é›†åˆã€‚

```python
Manager.raw(raw_query, params=None, translations=None)

# ä½¿ç”¨æ—¶å°±è¿™æ ·
sql = 'SELECT * FROM books_author'
Book.objects.raw(sql)
```



### 9.5.1 æ¨¡å‹å¯¹åº”çš„è¡¨å



å¦‚æœæ²¡å®šä¹‰è¿‡æ¨¡å‹çš„è¡¨åï¼Œåº•å±‚é»˜è®¤æŠŠè¡¨åå¼„æˆï¼šåº”ç”¨åçš„å°å†™_æ¨¡å‹åçš„å°å†™ï¼Œå¦‚books_publisherã€‚

ä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰è¡¨åï¼Œ

```python
class Author(models.Model):
    """ä½œè€…"""

    first_name = models.CharField(max_length=30)
    last_name = models.CharField(max_length=40)
    email = models.EmailField(blank=True, null=True)

    def __str__(self):
        return '%s %s' % (self.first_name, self.last_name)

	class Meta:
        db_table = 'author'  # æ¨¡å‹å¯¹åº”åœ¨æ•°æ®åº“çš„è¡¨å
```



### 9.5.2 æŠŠæŸ¥è¯¢ä¸­çš„å­—æ®µæ˜ å°„åˆ°æ¨¡å‹å­—æ®µä¸Š



åŸå§‹sqlä¸­æŸ¥è¯¢çš„å­—æ®µæ²¡æœ‰é¡ºåºè¦æ±‚ã€‚

å¦‚æœæ•°æ®åº“çš„å­—æ®µè·Ÿæ¨¡å‹çš„å­—æ®µä¸ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨åˆ«åçŸ«æ­£ã€‚

```python
Author.objects.raw('''SELECT first AS first_name,
                        last AS last_name,
                        bd AS birth_date,
                        pk AS id,
                        FROM author''')
```



### 9.5.3 ç´¢å¼•æŸ¥æ‰¾



å› ä¸ºè¿”å›çš„ç»“æœé›†åˆæ˜¯ä¸€ä¸ªåºåˆ—ç±»å‹ï¼Œæ˜¯å¯ä»¥è¢«ç´¢å¼•çš„ã€‚

```python
Author.objects.raw('SELECT * FROM author LIMIT 1')[0]
```



## 9.6 ç›´æ¥æ‰§è¡Œè‡ªå®šä¹‰çš„ SQL



å¦‚æœ Manager.raw() è¿˜ä¸å¤Ÿç”¨ï¼Œé‚£å°±ç›´æ¥åŸç”Ÿäº†:strawberry: ã€‚



```python
from django.db import connection

def my_custom_sql(self):
    cursor = connection.cursor()
    cursor.execute("UPDATE bar SET foo = 1 WHERE baz = %s", [self.baz])
    cursor.execute("SELECT foo FROM bar WHERE baz = %s", [self.baz])
    row = cursor.fetchone()
    return row
```





# 10 é€šç”¨è§†å›¾



é€šç”¨è§†å›¾æŠŠè§†å›¾å¼€å‘ä¸­å¸¸ç”¨çš„å†™æ³•å’Œæ¨¡å¼æŠ½è±¡å‡ºæ¥ï¼Œè®©ä½ ç¼–å†™å°‘é‡ä»£ç å°±èƒ½å¿«é€Ÿå®ç°å¸¸è§çš„æ•°æ®è§†å›¾ã€‚

æ˜¾ç¤ºå¯¹è±¡åˆ—è¡¨å°±æ˜¯è¿™æ ·ä¸€ç§ä»»åŠ¡ã€‚

æœ‰äº†é€šç”¨è§†å›¾ï¼Œå¯ä»¥æŠŠæ¨¡å‹ä½œä¸ºé¢å¤–çš„å‚æ•°ä¼ ç»™ URL é…ç½®ã€‚



è¿™ä¸ªæŒºé‡è¦ï¼Œdjangoçš„adminæ¨¡å—å°±æ˜¯è¿™ä¹ˆæ•´å‡ºæ¥çš„ã€‚å­¦å¥½è¿™å—ï¼Œæˆ–è®¸å°±å¯ä»¥é‡æ„adminäº†ï¼ˆæ¯•ç«Ÿadminè¿™ä¹ˆè€çš„é£æ ¼...ï¼‰ã€‚



## 10.1 å¯¹è±¡çš„é€šç”¨è§†å›¾



åœ¨è§†å›¾ä¸­å‘ˆç°æ•°æ®åº“é‡Œçš„å†…å®¹æ—¶æœ€èƒ½ä½“ç° Django çš„é€šç”¨è§†å›¾æ˜¯å¤šä¹ˆå¼ºå¤§ã€‚



ä¸€ä¸ªç®€å•ä¾‹å­

- 1 åˆ›å»ºæ¨¡å‹

```python
# æ¨¡å‹:models.py
class Publisher(models.Model):
    """å‡ºç‰ˆç¤¾"""

    name = models.CharField(max_length=30)
    address = models.CharField(max_length=50, blank=True, null=True)
    city = models.CharField(max_length=60, blank=True, null=True)
    state_province = models.CharField(max_length=30, blank=True, null=True)
    country = models.CharField(max_length=50, blank=True, null=True)
    website = models.URLField(blank=True, null=True)

    def __str__(self):
        return self.name

    class Meta:
        db_table = 'publisher'
        ordering = ["-name"]
```

- 2 urls.py

```python
# é¡¹ç›®çš„urls.py
from django.contrib import admin
from django.urls import path, include
from django.conf.urls import url

urlpatterns = [
    url('admin/', admin.site.urls),
    url(r'^publisher/', include(('books.urls', 'books'), namespace='books')),
]

# booksä¸‹çš„urls.py
from django.conf.urls import url
from books.views.common_views import PublisherList

urlpatterns = [
    url(r'^$', PublisherList.as_view())
]

```

åœ¨booksä¸‹åˆ›å»ºä¸€ä¸ªtemplatesæ–‡ä»¶å¤¹ï¼Œå†åœ¨templatesä¸‹åˆ›å»ºbooksæ–‡ä»¶å¤¹ï¼Œå†åœ¨booksä¸‹åˆ›å»ºåä¸ºpublisher_list.htmlçš„æ¨¡æ¿ï¼Œè¿™äº›æ˜¯å¿…é¡»çš„ï¼Œä¸èƒ½ä¹±å†™ï¼Œä¸ç„¶åº•å±‚åŠ è½½ä¸åˆ°ã€‚

æ­¤å¤–ï¼Œ settingsçš„DjangoTemplates åå°çš„ APP_DIRS é€‰é¡¹è®¾ä¸º Trueã€‚



- 3 æ¨¡æ¿

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <h2>Publishers</h2>
    <ul>
        {% for publisher in object_list %}
        <li>{{ publisher.name }}</li>
        {% endfor %}
    </ul>
</body>
</html>
```



## 10.2 è‡ªå®šä¹‰æ¨¡æ¿ä¸Šä¸‹æ–‡çš„åç§°



ä¸Šä¸‹æ–‡æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œæ”¾åœ¨é‡Œé¢çš„ä¸œè¥¿ï¼Œåªè¦é¡¹ç›®åœ¨è¿è¡Œï¼Œæ¨¡æ¿éƒ½å¯ä»¥æ‹¿åˆ°é‡Œé¢çš„å†…å®¹ã€‚



```python
# views.py
from django.views.generic import ListView
from books.models import Publisher
	
class PublisherList(ListView):
    model = Publisher
    # é»˜è®¤æ•°æ®é›†åˆçš„åç§°æ˜¯object_listï¼Œå¯ä»¥ç”¨è¿™æ–¹æ³•ä¿®æ”¹
    context_object_name = 'pulisher_list'
```



## 10.3 æä¾›é¢å¤–çš„ä¸Šä¸‹æ–‡å˜é‡



é€šå¸¸ï¼Œé™¤äº†é€šç”¨è§†å›¾æä¾›çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æƒ³æ˜¾ç¤ºä¸€äº›é¢å¤–ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œåœ¨å„ä¸ªå‡ºç‰ˆç¤¾çš„è¯¦ç»†ä¿¡æ¯é¡µé¢æ˜¾ç¤ºå‡ºç‰ˆçš„å›¾ä¹¦åˆ—è¡¨ã€‚

é¢å¤–çš„ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡æ‰©å±• DetailView ï¼Œè‡ªå·±å®ç° get_context_data æ–¹æ³•ã€‚é»˜è®¤çš„å®ç°åªä¸ºæ¨¡æ¿æä¾›è¯¥æ˜¾ç¤ºçš„å¯¹è±¡ï¼Œä¸è¿‡å¯
ä»¥è¦†ç›–ï¼Œæä¾›æ›´å¤šä¿¡æ¯ã€‚



```python
from django.views.generic import DetailView
from books.models import Publisher, Book

class PublisherDetail(DetailView):
    model = Publisher
    
    def get_context_data(self, **kwargs):
        # å…ˆè°ƒç”¨åŸæ¥çš„å®ç°ï¼Œè·å–ä¸Šä¸‹æ–‡
        context = super(PublisherDetail, self).get_context_data(**kwargs)
        # æŠŠæ‰€æœ‰å›¾ä¹¦æ„æˆçš„æŸ¥è¯¢é›†åˆæ·»åŠ åˆ°ä¸Šä¸‹æ–‡ä¸­
        context['book_list'] = Book.objects.all()
        return context
```



## 10.4 æ˜¾ç¤ºå¯¹è±¡å­é›†





## 10.5 åŠ¨æ€è¿‡æ»¤









